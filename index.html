<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üßÄ SOysdomofon - Ultimate Edition üö™</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #0a0e27;
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
            position: relative;
        }

        /* –§–û–ù–´ –õ–û–ö–ê–¶–ò–ô */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease;
        }

        body.bg-entrance::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%231e3a8a" width="1000" height="1000"/></svg>'); }
        body.bg-district::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%23065f46" width="1000" height="1000"/></svg>'); }
        body.bg-city::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%237c2d12" width="1000" height="1000"/></svg>'); }
        body.bg-megapolis::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%236b21a8" width="1000" height="1000"/></svg>'); }
        body.bg-country::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%23991b1b" width="1000" height="1000"/></svg>'); }
        body.bg-continent::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%23b45309" width="1000" height="1000"/></svg>'); }
        body.bg-planet::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%2314532d" width="1000" height="1000"/></svg>'); }
        body.bg-galaxy::before { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><rect fill="%231e1b4b" width="1000" height="1000"/></svg>'); }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes cheeseFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-200px) rotate(360deg); opacity: 0; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px currentColor, 0 0 40px currentColor; }
            50% { box-shadow: 0 0 40px currentColor, 0 0 80px currentColor; }
        }

        @keyframes sauceAppear {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }

        @keyframes rankShine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes caseOpen {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        @keyframes itemReveal {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 1; transform: scale(1) rotate(360deg); }
        }

        /* === AUTH SCREEN === */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.5);
            padding: 50px 40px;
            max-width: 450px;
            width: 100%;
            animation: slideIn 0.6s ease;
        }

        .auth-logo h1 {
            font-size: 2.8em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .auth-logo p {
            color: #94a3b8;
            text-align: center;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: #94a3b8;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #e2e8f0;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 16px;
            color: white;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #fbbf24;
            background: rgba(255, 255, 255, 0.08);
        }

        .auth-button {
            width: 100%;
            padding: 16px;
            border: none;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3);
        }

        .auth-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(251, 191, 36, 0.5);
        }

        .error-message, .success-message {
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideIn 0.3s ease;
            font-size: 14px;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #86efac;
        }

        /* === GAME SCREEN === */
        .game-screen {
            display: none;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 2em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .header-left p {
            color: #94a3b8;
            font-weight: 300;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        .logout-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .admin-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3);
        }

        .transfer-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }

        .pvp-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
            animation: pulse 2s infinite;
        }

        .cases-btn {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.3);
            animation: glow 2s infinite;
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.5);
            color: white;
            padding: 20px;
            border-radius: 15px;
            z-index: 10000;
            animation: slideIn 0.5s ease;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .notification.success {
            border-color: rgba(34, 197, 94, 0.5);
        }

        .notification.error {
            border-color: rgba(239, 68, 68, 0.5);
        }

        /* === PVP ARENA === */
        .pvp-arena {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 20000;
            display: none;
        }

        .pvp-arena.active {
            display: flex;
            flex-direction: column;
        }

        .pvp-header {
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-bottom: 2px solid rgba(251, 191, 36, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .pvp-player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pvp-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: 900;
        }

        .pvp-stats {
            text-align: left;
        }

        .pvp-name {
            font-size: 1.2em;
            font-weight: 700;
        }

        .pvp-hits {
            font-size: 1.8em;
            font-weight: 900;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .pvp-battlefield {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .pvp-sauce {
            position: absolute;
            width: 100px;
            height: 100px;
            cursor: pointer;
            animation: sauceAppear 0.3s ease;
            transition: all 0.1s;
            font-size: 5em;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 0 20px currentColor);
            user-select: none;
        }

        .pvp-sauce:active {
            transform: scale(0.8);
        }

        .pvp-timer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 0 0 30px #fbbf24;
            z-index: 1;
        }

        .pvp-result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 60px;
            border-radius: 30px;
            text-align: center;
            border: 3px solid;
            z-index: 2;
        }

        .pvp-result.win {
            border-color: #10b981;
        }

        .pvp-result.lose {
            border-color: #ef4444;
        }

        .pvp-result h2 {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 900;
        }

        .pvp-result.win h2 {
            color: #10b981;
        }

        .pvp-result.lose h2 {
            color: #ef4444;
        }

        /* === RANK SYSTEM === */
        .rank-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
            text-transform: uppercase;
            background-size: 200% auto;
            animation: rankShine 3s linear infinite;
        }

        .rank-novice { background: linear-gradient(90deg, #71717a, #a1a1aa, #71717a); }
        .rank-bronze { background: linear-gradient(90deg, #d97706, #f59e0b, #d97706); }
        .rank-silver { background: linear-gradient(90deg, #71717a, #d4d4d8, #71717a); }
        .rank-gold { background: linear-gradient(90deg, #f59e0b, #fbbf24, #f59e0b); }
        .rank-platinum { background: linear-gradient(90deg, #3b82f6, #60a5fa, #3b82f6); }
        .rank-diamond { background: linear-gradient(90deg, #06b6d4, #22d3ee, #06b6d4); }
        .rank-master { background: linear-gradient(90deg, #8b5cf6, #a78bfa, #8b5cf6); }
        .rank-grandmaster { background: linear-gradient(90deg, #ef4444, #f87171, #ef4444); }

        /* === MODALS === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 2em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .close-modal {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: rotate(90deg);
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .admin-section h3 {
            color: #fbbf24;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .admin-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
        }

        .admin-input:focus {
            outline: none;
            border-color: #fbbf24;
        }

        .admin-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }

        .admin-button.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .admin-button.warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.3);
        }

        /* === CASES === */
        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .case-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .case-card:hover {
            transform: translateY(-10px);
            border-color: #fbbf24;
            box-shadow: 0 20px 60px rgba(251, 191, 36, 0.3);
        }

        .case-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .case-icon {
            font-size: 5em;
            margin-bottom: 15px;
        }

        .case-name {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .case-price {
            font-size: 1.5em;
            font-weight: 800;
            color: #fbbf24;
            margin-bottom: 15px;
        }

        .case-items-count {
            font-size: 0.9em;
            color: #94a3b8;
        }

        .case-opening {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 30000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .case-opening.active {
            display: flex;
        }

        .case-animation {
            text-align: center;
        }

        .case-box {
            font-size: 15em;
            animation: caseOpen 2s ease;
            margin-bottom: 30px;
        }

        .case-item-reveal {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            padding: 50px;
            border-radius: 30px;
            border: 3px solid;
            animation: itemReveal 0.8s ease;
        }

        .item-icon {
            font-size: 8em;
            margin-bottom: 20px;
        }

        .item-name {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .item-rarity {
            font-size: 1.2em;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 30px;
        }

        .rarity-common { background: #71717a; color: white; }
        .rarity-uncommon { background: #10b981; color: white; }
        .rarity-rare { background: #3b82f6; color: white; }
        .rarity-epic { background: #a855f7; color: white; }
        .rarity-legendary { background: #f59e0b; color: #0a0e27; }
        .rarity-mythic { background: #ef4444; color: white; }

        /* === MAIN CONTENT === */
        .main-content {
            display: grid;
            grid-template-columns: 340px 1fr 360px;
            gap: 20px;
        }

        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* === STATS PANEL === */
        .stats-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
        }

        .stats-panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.85em;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .rebirth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .rebirth-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.5);
        }

        .rebirth-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* === GAME AREA === */
        .game-area {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
        }

        .cheese-counter {
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .location-indicator {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.2em;
        }

        .intercom-container {
            position: relative;
            display: inline-block;
            margin: 30px 0;
        }

        .intercom {
            width: 320px;
            height: 420px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            border: 3px solid;
            animation: fadeChange 0.6s ease;
        }

        .intercom:active {
            transform: scale(0.95);
        }

        /* –†–ê–ó–ù–´–ï –°–¢–ò–õ–ò –î–û–ú–û–§–û–ù–û–í */
        .intercom.cyfral { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1e3a8a 100%); border-color: #3b82f6; box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4); }
        .intercom.metakom { background: linear-gradient(135deg, #065f46 0%, #047857 50%, #065f46 100%); border-color: #10b981; box-shadow: 0 20px 60px rgba(16, 185, 129, 0.4); }
        .intercom.vizit { background: linear-gradient(135deg, #7c2d12 0%, #9a3412 50%, #7c2d12 100%); border-color: #f97316; box-shadow: 0 20px 60px rgba(249, 115, 22, 0.4); }
        .intercom.eltis { background: linear-gradient(135deg, #6b21a8 0%, #7e22ce 50%, #6b21a8 100%); border-color: #a855f7; box-shadow: 0 20px 60px rgba(168, 85, 247, 0.4); }
        .intercom.stalker { background: linear-gradient(135deg, #991b1b 0%, #b91c1c 50%, #991b1b 100%); border-color: #ef4444; box-shadow: 0 20px 60px rgba(239, 68, 68, 0.4); }
        .intercom.quantum { background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #1e3a8a 100%); border-color: #8b5cf6; box-shadow: 0 20px 60px rgba(139, 92, 246, 0.4); }
        .intercom.neon { background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 50%, #14b8a6 100%); border-color: #22d3ee; box-shadow: 0 20px 60px rgba(34, 211, 238, 0.4); }
        .intercom.gold { background: linear-gradient(135deg, #d97706 0%, #f59e0b 50%, #d97706 100%); border-color: #fbbf24; box-shadow: 0 20px 60px rgba(251, 191, 36, 0.4); }

        .intercom-screen {
            width: 85%;
            height: 32%;
            margin: 20px auto;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6em;
            font-weight: 800;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: inset 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .intercom.cyfral .intercom-screen { color: #1e3a8a; }
        .intercom.metakom .intercom-screen { color: #065f46; }
        .intercom.vizit .intercom-screen { color: #7c2d12; }
        .intercom.eltis .intercom-screen { color: #6b21a8; }
        .intercom.stalker .intercom-screen { color: #991b1b; }
        .intercom.quantum .intercom-screen { color: #7c3aed; }
        .intercom.neon .intercom-screen { color: #14b8a6; }
        .intercom.gold .intercom-screen { color: #d97706; }

        .intercom-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 25px;
        }

        .intercom-btn {
            width: 100%;
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* –£–ö–†–ê–®–ï–ù–ò–Ø –ù–ê –î–û–ú–û–§–û–ù–ï */
        .intercom-decoration {
            position: absolute;
            font-size: 3em;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .decoration-top-left { top: 5%; left: 5%; }
        .decoration-top-right { top: 5%; right: 5%; }
        .decoration-bottom-left { bottom: 15%; left: 5%; }
        .decoration-bottom-right { bottom: 15%; right: 5%; }

        /* –°–û–£–° –í–û–ó–õ–ï –î–û–ú–û–§–û–ù–ê */
        .sauce-display {
            position: absolute;
            top: 10%;
            right: -60px;
            font-size: 4em;
            animation: float 2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px currentColor);
        }

        .cheese-splash {
            position: fixed;
            pointer-events: none;
            font-size: 2.5em;
            animation: cheeseFloat 1.5s ease-out forwards;
            z-index: 9999;
            font-weight: 900;
            text-shadow: 0 0 20px currentColor;
        }

        .click-info {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: 700;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* === SHOP === */
        .shop-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shop-panel h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .shop-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .shop-tab {
            flex: 1;
            min-width: 70px;
            padding: 10px 5px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .shop-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .shop-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.5);
            transform: translateX(5px);
        }

        .shop-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .shop-item-name {
            font-weight: 700;
            font-size: 0.95em;
        }

        .shop-item-level {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
        }

        .shop-item-desc {
            color: #94a3b8;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .shop-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .shop-item-cost {
            font-size: 1.1em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .buy-btn, .select-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .buy-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        .buy-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }

        .buy-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .select-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }

        .select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
        }

        .select-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        /* === LEADERBOARD === */
        .leaderboard {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
        }

        .leaderboard h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .leaderboard-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .leaderboard-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .leaderboard-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.3);
            transform: translateX(5px);
        }

        .leaderboard-rank {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.3em;
        }

        .leaderboard-rank.gold {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.5);
        }

        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(148, 163, 184, 0.5);
        }

        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(249, 115, 22, 0.5);
        }

        .leaderboard-rank:not(.gold):not(.silver):not(.bronze) {
            background: rgba(255, 255, 255, 0.1);
            color: #94a3b8;
        }

        .leaderboard-player {
            flex: 1;
            margin-left: 15px;
            font-weight: 700;
        }

        .leaderboard-score {
            font-weight: 800;
            font-size: 1.2em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* === SCROLLBAR === */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 10px;
        }

        .hidden {
            display: none !important;
        }

        textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            resize: vertical;
            min-height: 100px;
        }

        textarea:focus {
            outline: none;
            border-color: #fbbf24;
        }

        @media (max-width: 768px) {
            .intercom {
                width: 280px;
                height: 360px;
            }

            .pvp-sauce {
                width: 80px;
                height: 80px;
                font-size: 4em;
            }

            .sauce-display {
                right: -50px;
                font-size: 3em;
            }
        }
    </style>
</head>
<body class="bg-entrance">

    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-logo">
                <h1>üßÄ SOysdomofon</h1>
                <p>Ultimate Edition - –ö–µ–π—Å—ã & PVP</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">–í—Ö–æ–¥</button>
                <button class="auth-tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <div id="errorMessage" class="error-message hidden"></div>
            <div id="successMessage" class="success-message hidden"></div>

            <form id="authForm">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="loginInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
                </div>

                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>

                <button type="submit" class="auth-button" id="authButton">–í–û–ô–¢–ò</button>
            </form>
        </div>
    </div>

    <div id="gameScreen" class="game-screen">
        <div class="header">
            <div class="header-left">
                <h1>üßÄ SOysdomofon</h1>
                <p>–ò–≥—Ä–æ–∫: <span id="playerName"></span> | <span id="playerRank" class="rank-badge rank-novice">–ù–æ–≤–∏—á–æ–∫</span> | MMR: <span id="playerMMR">1000</span></p>
            </div>
            <div class="header-buttons">
                <button class="btn cases-btn" id="casesBtn">üì¶ –ö–ï–ô–°–´</button>
                <button class="btn pvp-btn" id="pvpBtn">‚öîÔ∏è PVP</button>
                <button class="btn transfer-btn" id="transferBtn">üí∏</button>
                <button class="btn admin-btn hidden" id="adminBtn">‚öôÔ∏è</button>
                <button class="btn logout-btn" id="logoutBtn">–í—ã—Ö–æ–¥</button>
            </div>
        </div>

        <div class="main-content">
            <div class="stats-panel">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                
                <div class="stat-item">
                    <div class="stat-label">–¢–µ–∫—É—â–∞—è –ª–æ–∫–∞—Ü–∏—è</div>
                    <div class="stat-value" id="currentLocation" style="font-size: 1.3em;">üè† –ü–æ–¥—ä–µ–∑–¥</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –ª–æ–∫–∞—Ü–∏–∏</div>
                    <div class="stat-value">x<span id="locationMultiplier">1</span></div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">–°—ã—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥—É</div>
                    <div class="stat-value" id="cheesePerSec">0</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                    <div class="stat-value" id="levelDisplay">1</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">PVP –ø–æ–±–µ–¥ / –ø–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                    <div class="stat-value" style="font-size: 1.3em;"><span id="pvpWins">0</span> / <span id="pvpLosses">0</span></div>
                </div>

                <div class="rebirth-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="stat-item">
                        <div class="stat-label">‚≠ê –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</div>
                        <div class="stat-value" id="rebirthCount">0</div>
                    </div>
                    <button class="rebirth-btn" id="rebirthBtn">
                        ‚≠ê –ü–ï–†–ï–†–û–î–ò–¢–¨–°–Ø (<span id="rebirthCost">1,000,000</span> üßÄ)
                    </button>
                </div>
            </div>

            <div>
                <div class="game-area">
                    <div class="location-indicator" id="locationName">üè† –ü–æ–¥—ä–µ–∑–¥ (x1)</div>

                    <div class="cheese-counter">
                        üßÄ <span id="cheeseCount">0</span>
                    </div>

                    <div class="intercom-container">
                        <div class="intercom cyfral" id="intercom">
                            <div class="intercom-screen">
                                <span id="intercomName">CYFRAL</span>
                            </div>
                            <div class="intercom-buttons">
                                <div class="intercom-btn">1</div>
                                <div class="intercom-btn">2</div>
                                <div class="intercom-btn">3</div>
                                <div class="intercom-btn">4</div>
                                <div class="intercom-btn">5</div>
                                <div class="intercom-btn">6</div>
                                <div class="intercom-btn">7</div>
                                <div class="intercom-btn">8</div>
                                <div class="intercom-btn">9</div>
                                <div class="intercom-btn">*</div>
                                <div class="intercom-btn">0</div>
                                <div class="intercom-btn">#</div>
                            </div>
                            <div id="intercomDecorations"></div>
                        </div>
                        <div class="sauce-display" id="sauceDisplay">üßÄ</div>
                    </div>

                    <div class="click-info">
                        ‚ö° +<span id="clickPower">1</span> —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫
                    </div>
                </div>

                <div class="leaderboard">
                    <h2>üèÜ –¢–æ–ø –ò–≥—Ä–æ–∫–æ–≤</h2>
                    
                    <div class="leaderboard-tabs">
                        <button class="leaderboard-tab active" data-lb-tab="balance">–ë–∞–ª–∞–Ω—Å</button>
                        <button class="leaderboard-tab" data-lb-tab="pvp">PVP</button>
                        <button class="leaderboard-tab" data-lb-tab="rebirths">–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</button>
                    </div>

                    <div id="leaderboardList">
                        <div style="text-align: center; color: #94a3b8; padding: 20px;">
                            –ó–∞–≥—Ä—É–∑–∫–∞...
                        </div>
                    </div>
                </div>
            </div>

            <div class="shop-panel">
                <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>

                <div class="shop-tabs">
                    <button class="shop-tab active" data-tab="upgrades">–£–ª—É—á—à–µ–Ω–∏—è</button>
                    <button class="shop-tab" data-tab="intercoms">–î–æ–º–æ—Ñ–æ–Ω—ã</button>
                    <button class="shop-tab" data-tab="sauce">–°–æ—É—Å—ã</button>
                    <button class="shop-tab" data-tab="locations">–õ–æ–∫–∞—Ü–∏–∏</button>
                </div>

                <div id="upgradesTab" class="shop-content"></div>
                <div id="intercomsTab" class="shop-content hidden"></div>
                <div id="sauceTab" class="shop-content hidden"></div>
                <div id="locationsTab" class="shop-content hidden"></div>
            </div>
        </div>
    </div>

    <!-- PVP ARENA -->
    <div id="pvpArena" class="pvp-arena">
        <div class="pvp-header">
            <div class="pvp-player-info">
                <div class="pvp-avatar">üë§</div>
                <div class="pvp-stats">
                    <div class="pvp-name" id="pvpPlayer1Name">–í—ã</div>
                    <div class="pvp-hits">–•–∏—Ç—ã: <span id="pvpPlayer1Hits">0</span></div>
                </div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2em; font-weight: 900; color: #fbbf24;">‚öîÔ∏è</div>
                <div style="font-size: 1.5em; font-weight: 700;">–°—Ç–∞–≤–∫–∞: <span id="pvpBet">0</span> üßÄ</div>
            </div>
            <div class="pvp-player-info">
                <div class="pvp-stats" style="text-align: right;">
                    <div class="pvp-name" id="pvpPlayer2Name">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</div>
                    <div class="pvp-hits">–•–∏—Ç—ã: <span id="pvpPlayer2Hits">0</span></div>
                </div>
                <div class="pvp-avatar">ü§ñ</div>
            </div>
        </div>
        <div class="pvp-battlefield" id="pvpBattlefield">
            <div class="pvp-timer" id="pvpTimer">3</div>
        </div>
    </div>

    <!-- CASES MODAL -->
    <div id="casesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì¶ –ö–µ–π—Å—ã</h2>
                <button class="close-modal" onclick="closeCasesModal()">√ó</button>
            </div>
            <div class="case-grid" id="caseGrid"></div>
        </div>
    </div>

    <!-- CASE OPENING -->
    <div id="caseOpening" class="case-opening">
        <div class="case-animation">
            <div class="case-box" id="caseBox">üì¶</div>
            <div id="caseResult"></div>
        </div>
    </div>

    <div id="transferModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üí∏ –ü–µ—Ä–µ–≤–æ–¥</h2>
                <button class="close-modal" onclick="closeTransferModal()">√ó</button>
            </div>
            <div class="admin-section">
                <input type="text" class="admin-input" id="transferRecipient" placeholder="–õ–æ–≥–∏–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                <input type="number" class="admin-input" id="transferAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã—Ä–∞">
                <button class="admin-button" onclick="sendTransfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="pvpModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚öîÔ∏è PVP –ê—Ä–µ–Ω–∞</h2>
                <button class="close-modal" onclick="closePVPModal()">√ó</button>
            </div>
            <div class="admin-section">
                <h3>–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">–†–∞–Ω–≥</div>
                        <div id="pvpModalRank" class="rank-badge rank-novice" style="font-size: 1.1em;">–ù–æ–≤–∏—á–æ–∫</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">MMR</div>
                        <div style="font-size: 1.8em; font-weight: 800; color: #fbbf24;"><span id="pvpModalMMR">1000</span></div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">–ü–æ–±–µ–¥</div>
                        <div style="font-size: 1.8em; font-weight: 800; color: #10b981;"><span id="pvpModalWins">0</span></div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">–ü–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                        <div style="font-size: 1.8em; font-weight: 800; color: #ef4444;"><span id="pvpModalLosses">0</span></div>
                    </div>
                </div>

                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É (—Ç–æ–ª—å–∫–æ –±–æ—Ç)</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                    <button class="admin-button" onclick="startPVP(1000)">1K üßÄ<br><small style="opacity: 0.7;">–õ–µ–≥–∫–æ</small></button>
                    <button class="admin-button" onclick="startPVP(5000)">5K üßÄ<br><small style="opacity: 0.7;">–ù–æ—Ä–º</small></button>
                    <button class="admin-button" onclick="startPVP(10000)">10K üßÄ<br><small style="opacity: 0.7;">–°—Ä–µ–¥–Ω–µ</small></button>
                    <button class="admin-button" onclick="startPVP(50000)">50K üßÄ<br><small style="opacity: 0.7;">–°–ª–æ–∂–Ω–æ</small></button>
                    <button class="admin-button" onclick="startPVP(100000)">100K üßÄ<br><small style="opacity: 0.7;">–û—á–µ–Ω—å</small></button>
                    <button class="admin-button" onclick="startPVP(500000)">500K üßÄ<br><small style="opacity: 0.7;">–ë–ï–ó–£–ú–ò–ï</small></button>
                </div>

                <div style="padding: 15px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px;">
                    <div style="font-weight: 700; margin-bottom: 10px;">‚öîÔ∏è –ü—Ä–∞–≤–∏–ª–∞:</div>
                    <div style="font-size: 0.9em; color: #94a3b8; line-height: 1.6;">
                        ‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —Å–æ—É—Å–∞–º –±—ã—Å—Ç—Ä–µ–µ –±–æ—Ç–∞<br>
                        ‚Ä¢ –ö—Ç–æ –ø–µ—Ä–≤—ã–º –Ω–∞–Ω–µ—Å–µ—Ç 20 —Ö–∏—Ç–æ–≤ - –ø–æ–±–µ–¥–∏—Ç<br>
                        ‚Ä¢ –ß–µ–º –≤—ã—à–µ —Å—Ç–∞–≤–∫–∞ - —Ç–µ–º —Å–ª–æ–∂–Ω–µ–µ –±–æ—Ç<br>
                        ‚Ä¢ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∑–∞–±–∏—Ä–∞–µ—Ç –æ–±–µ —Å—Ç–∞–≤–∫–∏
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è –ê–¥–º–∏–Ω</h2>
                <button class="close-modal" onclick="closeAdminModal()">√ó</button>
            </div>
            <div id="adminContent"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const app = initializeApp({
            databaseURL: "https://sirnik-3356a-default-rtdb.firebaseio.com/"
        });
        const database = getDatabase(app);

        let currentUser = null;
        let isAuthMode = true;
        let gameData = {
            cheese: 0,
            totalCheese: 0,
            allTimeCheese: 0,
            level: 1,
            rebirths: 0,
            clickPower: 1,
            cheesePerSecond: 0,
            upgrades: {},
            intercoms: ['cyfral'],
            currentIntercom: 'cyfral',
            sauces: ['basic'],
            currentSauce: 'basic',
            intercomBonus: 1,
            sauceBonus: 0,
            isAdmin: false,
            isBanned: false,
            currentLocation: 'entrance',
            locationMultiplier: 1,
            pvpWins: 0,
            pvpLosses: 0,
            pvpMMR: 1000,
            inventory: {
                decorations: [],
                backgrounds: []
            },
            equipped: {
                decoration: null
            },
            openedCases: {}
        };

        const upgradesList = [
            { id: 'finger', name: 'üëÜ –ü–∞–ª–µ—Ü', desc: '+1 —Å—ã—Ä–∞/–∫–ª–∏–∫', baseCost: 50, type: 'click', power: 1, scale: 1.5 },
            { id: 'glove', name: 'üß§ –ü–µ—Ä—á–∞—Ç–∫–∞', desc: '+3 —Å—ã—Ä–∞/–∫–ª–∏–∫', baseCost: 250, type: 'click', power: 3, scale: 1.5 },
            { id: 'brush2', name: 'üñåÔ∏è –ö–∏—Å—Ç—å', desc: '+8 —Å—ã—Ä–∞/–∫–ª–∏–∫', baseCost: 1000, type: 'click', power: 8, scale: 1.6 },
            { id: 'roller', name: 'üé® –í–∞–ª–∏–∫', desc: '+20 —Å—ã—Ä–∞/–∫–ª–∏–∫', baseCost: 5000, type: 'click', power: 20, scale: 1.6 },
            { id: 'sprayer', name: 'üíß –°–ø—Ä–µ–π', desc: '+50 —Å—ã—Ä–∞/–∫–ª–∏–∫', baseCost: 25000, type: 'click', power: 50, scale: 1.7 },
            { id: 'bucket', name: 'ü™£ –í–µ–¥—Ä–æ', desc: '+150 —Å—ã—Ä–∞/–∫–ª–∏–∫', baseCost: 100000, type: 'click', power: 150, scale: 1.7 },
            { id: 'auto', name: 'ü§ñ –†–æ–±–æ—Ç', desc: '+1 —Å—ã—Ä/—Å–µ–∫', baseCost: 100, type: 'auto', power: 1, scale: 1.7 },
            { id: 'sponge', name: 'üßΩ –ì—É–±–∫–∞', desc: '+5 —Å—ã—Ä/—Å–µ–∫', baseCost: 500, type: 'auto', power: 5, scale: 1.7 },
            { id: 'drone', name: 'üöÅ –î—Ä–æ–Ω', desc: '+15 —Å—ã—Ä/—Å–µ–∫', baseCost: 2500, type: 'auto', power: 15, scale: 1.8 },
            { id: 'brush', name: 'üñåÔ∏è –ê–≤—Ç–æ-–∫–∏—Å—Ç—å', desc: '+50 —Å—ã—Ä/—Å–µ–∫', baseCost: 10000, type: 'auto', power: 50, scale: 1.8 },
            { id: 'spray', name: 'üí¶ –†–∞—Å–ø—ã–ª–∏—Ç–µ–ª—å', desc: '+150 —Å—ã—Ä/—Å–µ–∫', baseCost: 50000, type: 'auto', power: 150, scale: 1.9 },
            { id: 'machine', name: '‚öôÔ∏è –ú–∞—à–∏–Ω–∞', desc: '+500 —Å—ã—Ä/—Å–µ–∫', baseCost: 250000, type: 'auto', power: 500, scale: 1.9 },
        ];

        const intercomsList = [
            { id: 'cyfral', name: 'CYFRAL', bonus: 1.0, cost: 0 },
            { id: 'metakom', name: '–ú–ï–¢–ê–ö–û–ú', bonus: 1.10, cost: 25000 },
            { id: 'vizit', name: 'VIZIT', bonus: 1.20, cost: 100000 },
            { id: 'eltis', name: 'ELTIS', bonus: 1.30, cost: 500000 },
            { id: 'stalker', name: '–°–¢–ê–õ–ö–ï–†', bonus: 1.40, cost: 2500000 },
            { id: 'quantum', name: 'QUANTUM', bonus: 1.50, cost: 10000000 },
            { id: 'neon', name: 'NEON', bonus: 1.60, cost: 50000000 },
            { id: 'gold', name: 'GOLD', bonus: 2.0, cost: 250000000 },
        ];

        const saucesList = [
            { id: 'basic', name: '–°—ã—Ä', icon: 'üßÄ', bonus: 0, cost: 0 },
            { id: 'mayo', name: '–ú–∞–π–æ–Ω–µ–∑', icon: 'ü•õ', bonus: 10, cost: 15000 },
            { id: 'ketchup', name: '–ö–µ—Ç—á—É–ø', icon: 'üçÖ', bonus: 30, cost: 75000 },
            { id: 'mustard', name: '–ì–æ—Ä—á–∏—Ü–∞', icon: 'üå≠', bonus: 100, cost: 400000 },
            { id: 'soy', name: '–°–æ–µ–≤—ã–π', icon: 'üç∂', bonus: 300, cost: 2000000 },
            { id: 'bbq', name: '–ë–∞—Ä–±–µ–∫—é', icon: 'üçñ', bonus: 1000, cost: 10000000 },
            { id: 'honey', name: '–ú–µ–¥–æ–≤—ã–π', icon: 'üçØ', bonus: 3000, cost: 50000000 },
            { id: 'chili', name: '–ß–∏–ª–∏', icon: 'üå∂Ô∏è', bonus: 10000, cost: 250000000 },
            { id: 'wasabi', name: '–í–∞—Å–∞–±–∏', icon: 'üü¢', bonus: 30000, cost: 1000000000 },
            { id: 'truffle', name: '–¢—Ä—é—Ñ–µ–ª—å', icon: 'üçÑ', bonus: 100000, cost: 5000000000 },
        ];

        const locationsList = [
            { id: 'entrance', name: '–ü–æ–¥—ä–µ–∑–¥', icon: 'üè†', multiplier: 1.0, cost: 0, requiredRebirths: 0 },
            { id: 'district', name: '–†–∞–π–æ–Ω', icon: 'üèòÔ∏è', multiplier: 1.2, cost: 100000, requiredRebirths: 1 },
            { id: 'city', name: '–ì–æ—Ä–æ–¥', icon: 'üèôÔ∏è', multiplier: 1.4, cost: 1000000, requiredRebirths: 3 },
            { id: 'megapolis', name: '–ú–µ–≥–∞–ø–æ–ª–∏—Å', icon: 'üåÜ', multiplier: 1.7, cost: 10000000, requiredRebirths: 5 },
            { id: 'country', name: '–°—Ç—Ä–∞–Ω–∞', icon: 'üó∫Ô∏è', multiplier: 2.0, cost: 100000000, requiredRebirths: 10 },
            { id: 'continent', name: '–ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç', icon: 'üåç', multiplier: 2.5, cost: 1000000000, requiredRebirths: 20 },
            { id: 'planet', name: '–ü–ª–∞–Ω–µ—Ç–∞', icon: 'üåé', multiplier: 3.0, cost: 10000000000, requiredRebirths: 35 },
            { id: 'galaxy', name: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', icon: 'üåå', multiplier: 4.0, cost: 100000000000, requiredRebirths: 50 },
        ];

        // –°–ò–°–¢–ï–ú–ê –ö–ï–ô–°–û–í
        const casesList = [
            {
                id: 'starter',
                name: '–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–µ–π—Å',
                icon: 'üì¶',
                price: 1000,
                items: [
                    { id: 'keychain1', name: '–ë—Ä–µ–ª–æ–∫ —Å—ã—Ä', icon: 'üßÄ', rarity: 'common', type: 'decoration' },
                    { id: 'keychain2', name: '–ë—Ä–µ–ª–æ–∫ –∫–ª—é—á', icon: 'üîë', rarity: 'common', type: 'decoration' },
                    { id: 'keychain3', name: '–ë—Ä–µ–ª–æ–∫ —Å–µ—Ä–¥—Ü–µ', icon: '‚ù§Ô∏è', rarity: 'uncommon', type: 'decoration' },
                    { id: 'keychain4', name: '–ë—Ä–µ–ª–æ–∫ –∑–≤–µ–∑–¥–∞', icon: '‚≠ê', rarity: 'uncommon', type: 'decoration' },
                    { id: 'keychain5', name: '–ë—Ä–µ–ª–æ–∫ –∫–æ—Ä–æ–Ω–∞', icon: 'üëë', rarity: 'rare', type: 'decoration' },
                ]
            },
            {
                id: 'premium',
                name: '–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å',
                icon: 'üéÅ',
                price: 10000,
                items: [
                    { id: 'keychain6', name: '–ë—Ä–µ–ª–æ–∫ –∞–ª–º–∞–∑', icon: 'üíé', rarity: 'rare', type: 'decoration' },
                    { id: 'keychain7', name: '–ë—Ä–µ–ª–æ–∫ –º–æ–ª–Ω–∏—è', icon: '‚ö°', rarity: 'rare', type: 'decoration' },
                    { id: 'keychain8', name: '–ë—Ä–µ–ª–æ–∫ –æ–≥–æ–Ω—å', icon: 'üî•', rarity: 'epic', type: 'decoration' },
                    { id: 'keychain9', name: '–ë—Ä–µ–ª–æ–∫ —á–µ—Ä–µ–ø', icon: 'üíÄ', rarity: 'epic', type: 'decoration' },
                    { id: 'keychain10', name: '–ë—Ä–µ–ª–æ–∫ –¥—Ä–∞–∫–æ–Ω', icon: 'üêâ', rarity: 'legendary', type: 'decoration' },
                    { id: 'keychain11', name: '–ë—Ä–µ–ª–æ–∫ –µ–¥–∏–Ω–æ—Ä–æ–≥', icon: 'ü¶Ñ', rarity: 'legendary', type: 'decoration' },
                ]
            },
            {
                id: 'elite',
                name: '–≠–ª–∏—Ç–Ω—ã–π –∫–µ–π—Å',
                icon: 'üíº',
                price: 100000,
                items: [
                    { id: 'keychain12', name: '–ë—Ä–µ–ª–æ–∫ –≥–∞–ª–∞–∫—Ç–∏–∫–∞', icon: 'üåå', rarity: 'legendary', type: 'decoration' },
                    { id: 'keychain13', name: '–ë—Ä–µ–ª–æ–∫ —Ä–∞–¥—É–≥–∞', icon: 'üåà', rarity: 'legendary', type: 'decoration' },
                    { id: 'keychain14', name: '–ë—Ä–µ–ª–æ–∫ –∫–æ—Å–º–æ—Å', icon: 'üöÄ', rarity: 'mythic', type: 'decoration' },
                    { id: 'keychain15', name: '–ë—Ä–µ–ª–æ–∫ –∏–Ω—Ñ–∏–Ω–∏—Ç–∏', icon: '‚àû', rarity: 'mythic', type: 'decoration' },
                    { id: 'keychain16', name: '–ë—Ä–µ–ª–æ–∫ –±–æ–≥', icon: '‚òÄÔ∏è', rarity: 'mythic', type: 'decoration' },
                ]
            },
        ];

        const rankThresholds = [
            { name: '–ù–æ–≤–∏—á–æ–∫', mmr: 0, class: 'rank-novice' },
            { name: '–ë—Ä–æ–Ω–∑–∞', mmr: 1200, class: 'rank-bronze' },
            { name: '–°–µ—Ä–µ–±—Ä–æ', mmr: 1400, class: 'rank-silver' },
            { name: '–ó–æ–ª–æ—Ç–æ', mmr: 1600, class: 'rank-gold' },
            { name: '–ü–ª–∞—Ç–∏–Ω–∞', mmr: 1800, class: 'rank-platinum' },
            { name: '–ê–ª–º–∞–∑', mmr: 2000, class: 'rank-diamond' },
            { name: '–ú–∞—Å—Ç–µ—Ä', mmr: 2300, class: 'rank-master' },
            { name: '–ì—Ä–∞–Ω–¥-–ú–∞—Å—Ç–µ—Ä', mmr: 2600, class: 'rank-grandmaster' },
        ];

        function getRankFromMMR(mmr) {
            for (let i = rankThresholds.length - 1; i >= 0; i--) {
                if (mmr >= rankThresholds[i].mmr) {
                    return rankThresholds[i];
                }
            }
            return rankThresholds[0];
        }

        upgradesList.forEach(u => {
            if (gameData.upgrades[u.id] === undefined) {
                gameData.upgrades[u.id] = 0;
            }
        });

        const savedUser = localStorage.getItem('soysdomofon_user');
        if (savedUser) {
            currentUser = savedUser;
            loadGameData();
        }

        document.getElementById('loginTab').addEventListener('click', function() {
            isAuthMode = true;
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('authButton').textContent = '–í–û–ô–¢–ò';
        });

        document.getElementById('registerTab').addEventListener('click', function() {
            isAuthMode = false;
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('authButton').textContent = '–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø';
        });

        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const login = document.getElementById('loginInput').value.trim();
            const password = document.getElementById('passwordInput').value;

            if (!login || !password || login.length < 3 || password.length < 6) {
                showError('–õ–æ–≥–∏–Ω >= 3 —Å–∏–º–≤–æ–ª–æ–≤, –ø–∞—Ä–æ–ª—å >= 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }

            const userRef = ref(database, 'users/' + login);

            try {
                const snapshot = await get(userRef);

                if (isAuthMode) {
                    if (!snapshot.exists()) {
                        showError('–ê–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }

                    const userData = snapshot.val();
                    if (userData.password !== password) {
                        showError('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                        return;
                    }

                    if (userData.gameData && userData.gameData.isBanned) {
                        showError('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                        return;
                    }

                    currentUser = login;
                    localStorage.setItem('soysdomofon_user', login);
                    showSuccess('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
                    setTimeout(() => loadGameData(), 500);

                } else {
                    if (snapshot.exists()) {
                        showError('–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç!');
                        return;
                    }

                    gameData.isAdmin = login === 'qwenixDev01';

                    await set(userRef, {
                        password: password,
                        login: login,
                        gameData: gameData,
                        createdAt: Date.now()
                    });

                    currentUser = login;
                    localStorage.setItem('soysdomofon_user', login);
                    showSuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                    setTimeout(() => loadGameData(), 500);
                }
            } catch (error) {
                console.error(error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        });

        function showError(msg) {
            const div = document.getElementById('errorMessage');
            div.textContent = msg;
            div.classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            setTimeout(() => div.classList.add('hidden'), 5000);
        }

        function showSuccess(msg) {
            const div = document.getElementById('successMessage');
            div.textContent = msg;
            div.classList.remove('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            setTimeout(() => div.classList.add('hidden'), 3000);
        }

        async function loadGameData() {
            const snapshot = await get(ref(database, 'users/' + currentUser));

            if (snapshot.exists()) {
                const data = snapshot.val();
                const loadedData = data.gameData || {};
                
                gameData = {
                    ...gameData,
                    ...loadedData,
                    upgrades: loadedData.upgrades || {},
                    inventory: loadedData.inventory || { decorations: [], backgrounds: [] },
                    equipped: loadedData.equipped || { decoration: null },
                    openedCases: loadedData.openedCases || {}
                };

                if (gameData.pvpMMR === undefined) gameData.pvpMMR = 1000;
                if (gameData.pvpWins === undefined) gameData.pvpWins = 0;
                if (gameData.pvpLosses === undefined) gameData.pvpLosses = 0;
                if (gameData.currentLocation === undefined) gameData.currentLocation = 'entrance';
                if (gameData.locationMultiplier === undefined) gameData.locationMultiplier = 1;

                if (gameData.isBanned) {
                    alert('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                    localStorage.removeItem('soysdomofon_user');
                    location.reload();
                    return;
                }
                
                upgradesList.forEach(u => {
                    if (gameData.upgrades[u.id] === undefined) {
                        gameData.upgrades[u.id] = 0;
                    }
                });
                
                document.getElementById('playerName').textContent = currentUser;

                const rank = getRankFromMMR(gameData.pvpMMR);
                const rankBadge = document.getElementById('playerRank');
                rankBadge.textContent = rank.name;
                rankBadge.className = 'rank-badge ' + rank.class;
                document.getElementById('playerMMR').textContent = gameData.pvpMMR;

                if (gameData.isAdmin || currentUser === 'qwenixDev01') {
                    gameData.isAdmin = true;
                    document.getElementById('adminBtn').classList.remove('hidden');
                }
            }

            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            updateIntercomVisual(gameData.currentIntercom);
            updateLocationDisplay();
            updateSauceDisplay();
            updateDecoration();
            renderShop();
            updateUI();
            startGameLoop();
            loadLeaderboard();
            setupEventListeners();
        }

        function updateIntercomVisual(intercomId) {
            const intercomEl = document.getElementById('intercom');
            intercomEl.className = 'intercom ' + intercomId;
            
            const intercom = intercomsList.find(i => i.id === intercomId);
            if (intercom) {
                document.getElementById('intercomName').textContent = intercom.name;
            }
        }

        function updateLocationDisplay() {
            const location = locationsList.find(l => l.id === gameData.currentLocation);
            if (location) {
                document.getElementById('currentLocation').textContent = `${location.icon} ${location.name}`;
                document.getElementById('locationName').textContent = `${location.icon} ${location.name} (x${location.multiplier})`;
                document.getElementById('locationMultiplier').textContent = location.multiplier;
                gameData.locationMultiplier = location.multiplier;

                // –ú–µ–Ω—è–µ–º —Ñ–æ–Ω
                document.body.className = 'bg-' + location.id;
            }
        }

        function updateSauceDisplay() {
            const sauce = saucesList.find(s => s.id === gameData.currentSauce);
            if (sauce) {
                document.getElementById('sauceDisplay').textContent = sauce.icon;
            }
        }

        function updateDecoration() {
            const container = document.getElementById('intercomDecorations');
            container.innerHTML = '';

            if (gameData.equipped.decoration) {
                const decoration = casesList
                    .flatMap(c => c.items)
                    .find(i => i.id === gameData.equipped.decoration);

                if (decoration) {
                    const positions = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];
                    positions.forEach(pos => {
                        const decEl = document.createElement('div');
                        decEl.className = `intercom-decoration decoration-${pos}`;
                        decEl.textContent = decoration.icon;
                        container.appendChild(decEl);
                    });
                }
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', async function() {
            await saveGame();
            localStorage.removeItem('soysdomofon_user');
            location.reload();
        });

        document.getElementById('transferBtn').addEventListener('click', function() {
            document.getElementById('transferModal').classList.add('active');
        });

        document.getElementById('pvpBtn').addEventListener('click', function() {
            document.getElementById('pvpModal').classList.add('active');
            
            const rank = getRankFromMMR(gameData.pvpMMR);
            const rankBadge = document.getElementById('pvpModalRank');
            rankBadge.textContent = rank.name;
            rankBadge.className = 'rank-badge ' + rank.class;
            
            document.getElementById('pvpModalMMR').textContent = gameData.pvpMMR;
            document.getElementById('pvpModalWins').textContent = gameData.pvpWins;
            document.getElementById('pvpModalLosses').textContent = gameData.pvpLosses;
        });

        document.getElementById('casesBtn').addEventListener('click', function() {
            document.getElementById('casesModal').classList.add('active');
            renderCases();
        });

        document.getElementById('adminBtn').addEventListener('click', function() {
            document.getElementById('adminModal').classList.add('active');
        });

        window.closeTransferModal = function() {
            document.getElementById('transferModal').classList.remove('active');
        };

        window.closePVPModal = function() {
            document.getElementById('pvpModal').classList.remove('active');
        };

        window.closeCasesModal = function() {
            document.getElementById('casesModal').classList.remove('active');
        };

        window.closeAdminModal = function() {
            document.getElementById('adminModal').classList.remove('active');
        };

        window.sendTransfer = async function() {
            const recipient = document.getElementById('transferRecipient').value.trim();
            const amount = parseInt(document.getElementById('transferAmount').value);

            if (!recipient || !amount || amount <= 0 || amount > gameData.cheese || recipient === currentUser) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'error');
                return;
            }

            const recipientSnapshot = await get(ref(database, 'users/' + recipient));
            if (!recipientSnapshot.exists()) {
                showNotification('–ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            gameData.cheese -= amount;
            
            const transferId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            await set(ref(database, `transfers/${recipient}/${transferId}`), {
                from: currentUser,
                amount: amount,
                timestamp: Date.now(),
                processed: false
            });

            showNotification(`–ü–µ—Ä–µ–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`, 'success');
            updateUI();
            saveGame();
            closeTransferModal();
            
            document.getElementById('transferRecipient').value = '';
            document.getElementById('transferAmount').value = '';
        };

        // PVP –°–ò–°–¢–ï–ú–ê
        let pvpGameState = {
            active: false,
            bet: 0,
            player1Hits: 0,
            player2Hits: 0,
            countdown: 3,
            botDifficulty: 0.3,
            botSpeed: 800
        };

        window.startPVP = async function(bet) {
            if (gameData.cheese < bet) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—ã—Ä–∞', 'error');
                return;
            }

            gameData.cheese -= bet;
            updateUI();
            saveGame();

            closePVPModal();

            // –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç–∞–≤–∫–∏
            let difficulty, speed;
            if (bet <= 1000) {
                difficulty = 0.3;
                speed = 800;
            } else if (bet <= 5000) {
                difficulty = 0.4;
                speed = 700;
            } else if (bet <= 10000) {
                difficulty = 0.5;
                speed = 600;
            } else if (bet <= 50000) {
                difficulty = 0.6;
                speed = 500;
            } else if (bet <= 100000) {
                difficulty = 0.7;
                speed = 400;
            } else {
                difficulty = 0.85;
                speed = 300;
            }

            pvpGameState = {
                active: true,
                bet: bet,
                player1Hits: 0,
                player2Hits: 0,
                countdown: 3,
                botDifficulty: difficulty,
                botSpeed: speed
            };

            document.getElementById('pvpArena').classList.add('active');
            document.getElementById('pvpPlayer1Name').textContent = currentUser;
            document.getElementById('pvpPlayer2Name').textContent = '–ë–æ—Ç';
            document.getElementById('pvpBet').textContent = (bet * 2).toLocaleString();
            document.getElementById('pvpPlayer1Hits').textContent = '0';
            document.getElementById('pvpPlayer2Hits').textContent = '0';

            await countdownPVP();
            startPVPGame();
        };

        async function countdownPVP() {
            const timer = document.getElementById('pvpTimer');
            
            for (let i = 3; i > 0; i--) {
                timer.textContent = i;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            timer.textContent = '–ë–û–ô!';
            await new Promise(resolve => setTimeout(resolve, 500));
            timer.style.display = 'none';
        }

        function startPVPGame() {
            spawnPVPSauce();
        }

        function spawnPVPSauce() {
            if (!pvpGameState.active) return;

            const battlefield = document.getElementById('pvpBattlefield');
            const sauce = document.createElement('div');
            sauce.className = 'pvp-sauce';
            
            const randomSauce = saucesList[Math.floor(Math.random() * saucesList.length)];
            sauce.textContent = randomSauce.icon;
            
            const maxX = battlefield.clientWidth - 100;
            const maxY = battlefield.clientHeight - 100;
            sauce.style.left = Math.random() * maxX + 'px';
            sauce.style.top = Math.random() * maxY + 'px';

            let clicked = false;

            sauce.addEventListener('click', function() {
                if (!pvpGameState.active || clicked) return;
                clicked = true;
                
                pvpGameState.player1Hits++;
                document.getElementById('pvpPlayer1Hits').textContent = pvpGameState.player1Hits;
                sauce.remove();

                if (pvpGameState.player1Hits >= 20) {
                    endPVP(true);
                    return;
                }

                setTimeout(() => spawnPVPSauce(), 200);
            });

            battlefield.appendChild(sauce);

            // –ë–æ—Ç –∫–ª–∏–∫–∞–µ—Ç
            setTimeout(() => {
                if (sauce.parentElement && pvpGameState.active && !clicked && Math.random() < pvpGameState.botDifficulty) {
                    clicked = true;
                    pvpGameState.player2Hits++;
                    document.getElementById('pvpPlayer2Hits').textContent = pvpGameState.player2Hits;
                    sauce.remove();

                    if (pvpGameState.player2Hits >= 20) {
                        endPVP(false);
                        return;
                    }

                    setTimeout(() => spawnPVPSauce(), 200);
                }
            }, pvpGameState.botSpeed);
        }

        async function endPVP(playerWon) {
            pvpGameState.active = false;

            const battlefield = document.getElementById('pvpBattlefield');
            battlefield.innerHTML = '';

            const result = document.createElement('div');
            result.className = 'pvp-result ' + (playerWon ? 'win' : 'lose');
            
            const reward = pvpGameState.bet * 2;
            const mmrChange = playerWon ? Math.floor(20 + Math.random() * 10) : -Math.floor(15 + Math.random() * 10);

            if (playerWon) {
                gameData.cheese += reward;
                gameData.pvpWins++;
                gameData.pvpMMR += mmrChange;
                
                result.innerHTML = `
                    <h2>üéâ –ü–û–ë–ï–î–ê!</h2>
                    <div style="font-size: 2em; color: #fbbf24; margin: 20px 0;">+${reward.toLocaleString()} üßÄ</div>
                    <div style="font-size: 1.5em; color: #10b981;">MMR: +${mmrChange}</div>
                    <div style="margin-top: 30px;">
                        <button class="admin-button" onclick="closePVPArena()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
            } else {
                gameData.pvpLosses++;
                gameData.pvpMMR += mmrChange;
                
                result.innerHTML = `
                    <h2>üíÄ –ü–û–†–ê–ñ–ï–ù–ò–ï</h2>
                    <div style="font-size: 2em; color: #ef4444; margin: 20px 0;">-${pvpGameState.bet.toLocaleString()} üßÄ</div>
                    <div style="font-size: 1.5em; color: #ef4444;">MMR: ${mmrChange}</div>
                    <div style="margin-top: 30px;">
                        <button class="admin-button" onclick="closePVPArena()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
            }

            const rank = getRankFromMMR(gameData.pvpMMR);
            const rankBadge = document.getElementById('playerRank');
            rankBadge.textContent = rank.name;
            rankBadge.className = 'rank-badge ' + rank.class;
            document.getElementById('playerMMR').textContent = gameData.pvpMMR;

            battlefield.appendChild(result);
            updateUI();
            await saveGame();
        }

        window.closePVPArena = function() {
            document.getElementById('pvpArena').classList.remove('active');
            document.getElementById('pvpBattlefield').innerHTML = '<div class="pvp-timer" id="pvpTimer">3</div>';
            document.getElementById('pvpTimer').style.display = 'block';
        };

        // –°–ò–°–¢–ï–ú–ê –ö–ï–ô–°–û–í
        function renderCases() {
            const grid = document.getElementById('caseGrid');
            grid.innerHTML = '';

            casesList.forEach(caseItem => {
                const unopenedItems = caseItem.items.filter(item => 
                    !gameData.inventory.decorations.includes(item.id)
                );

                const allOpened = unopenedItems.length === 0;

                const card = document.createElement('div');
                card.className = 'case-card' + (allOpened ? ' locked' : '');
                
                card.innerHTML = `
                    <div class="case-icon">${caseItem.icon}</div>
                    <div class="case-name">${caseItem.name}</div>
                    <div class="case-price">${caseItem.price.toLocaleString()} üßÄ</div>
                    <div class="case-items-count">${unopenedItems.length}/${caseItem.items.length} –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                    ${allOpened ? '<div style="color: #10b981; font-weight: 700; margin-top: 10px;">–í–°–Å –û–¢–ö–†–´–¢–û</div>' : ''}
                `;

                if (!allOpened) {
                    card.addEventListener('click', () => openCase(caseItem.id));
                }

                grid.appendChild(card);
            });
        }

        async function openCase(caseId) {
            const caseItem = casesList.find(c => c.id === caseId);
            if (!caseItem) return;

            if (gameData.cheese < caseItem.price) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—ã—Ä–∞!', 'error');
                return;
            }

            const unopenedItems = caseItem.items.filter(item => 
                !gameData.inventory.decorations.includes(item.id)
            );

            if (unopenedItems.length === 0) {
                showNotification('–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ —ç—Ç–æ–≥–æ –∫–µ–π—Å–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã!', 'error');
                return;
            }

            gameData.cheese -= caseItem.price;
            updateUI();

            closeCasesModal();

            document.getElementById('caseOpening').classList.add('active');
            document.getElementById('caseBox').textContent = caseItem.icon;

            await new Promise(resolve => setTimeout(resolve, 2000));

            const wonItem = unopenedItems[Math.floor(Math.random() * unopenedItems.length)];
            gameData.inventory.decorations.push(wonItem.id);

            document.getElementById('caseResult').innerHTML = `
                <div class="case-item-reveal" style="border-color: ${getRarityColor(wonItem.rarity)}">
                    <div class="item-icon">${wonItem.icon}</div>
                    <div class="item-name">${wonItem.name}</div>
                    <div class="item-rarity rarity-${wonItem.rarity}">${getRarityName(wonItem.rarity)}</div>
                    <button class="admin-button" onclick="closeCaseOpening()">–ó–∞–±—Ä–∞—Ç—å</button>
                </div>
            `;

            await saveGame();
        }

        window.closeCaseOpening = function() {
            document.getElementById('caseOpening').classList.remove('active');
            document.getElementById('caseResult').innerHTML = '';
            showNotification('–ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!', 'success');
        };

        function getRarityColor(rarity) {
            const colors = {
                common: '#71717a',
                uncommon: '#10b981',
                rare: '#3b82f6',
                epic: '#a855f7',
                legendary: '#f59e0b',
                mythic: '#ef4444'
            };
            return colors[rarity] || '#71717a';
        }

        function getRarityName(rarity) {
            const names = {
                common: '–û–ë–´–ß–ù–´–ô',
                uncommon: '–ù–ï–û–ë–´–ß–ù–´–ô',
                rare: '–†–ï–î–ö–ò–ô',
                epic: '–≠–ü–ò–ß–ï–°–ö–ò–ô',
                legendary: '–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô',
                mythic: '–ú–ò–§–ò–ß–ï–°–ö–ò–ô'
            };
            return names[rarity] || '–û–ë–´–ß–ù–´–ô';
        }

        function showNotification(msg, type = 'success') {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = msg;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 5000);
        }

        async function saveGame() {
            if (!currentUser) return;
            
            try {
                await update(ref(database, 'users/' + currentUser + '/gameData'), gameData);
                await set(ref(database, 'leaderboard/' + currentUser), {
                    login: currentUser,
                    cheese: gameData.cheese,
                    allTimeCheese: gameData.allTimeCheese,
                    rebirths: gameData.rebirths,
                    level: gameData.level,
                    pvpMMR: gameData.pvpMMR,
                    pvpWins: gameData.pvpWins,
                    pvpLosses: gameData.pvpLosses
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        }

        function renderShop() {
            // Upgrades
            let upgradesHTML = '';
            upgradesList.forEach(upgrade => {
                const level = gameData.upgrades[upgrade.id] || 0;
                const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scale, level) * Math.pow(1.2, gameData.rebirths));
                
                upgradesHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">${upgrade.name}</div>
                            <div class="shop-item-level">–£—Ä. ${level}</div>
                        </div>
                        <div class="shop-item-desc">${upgrade.desc}</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${cost.toLocaleString()} üßÄ</div>
                            <button class="buy-btn" data-upgrade="${upgrade.id}">–ö—É–ø–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('upgradesTab').innerHTML = upgradesHTML;

            // Intercoms
            let intercomsHTML = '';
            intercomsList.forEach(intercom => {
                const owned = gameData.intercoms.includes(intercom.id);
                const active = gameData.currentIntercom === intercom.id;
                
                let buttonHTML = '';
                if (intercom.id === 'cyfral') {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-intercom="${intercom.id}">–í—ã–±—Ä–∞–Ω</button>`;
                } else if (owned) {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-intercom="${intercom.id}">${active ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å'}</button>`;
                } else {
                    buttonHTML = `<button class="buy-btn" data-buy-intercom="${intercom.id}" data-cost="${intercom.cost}">–ö—É–ø–∏—Ç—å</button>`;
                }
                
                intercomsHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">üö™ ${intercom.name}</div>
                        </div>
                        <div class="shop-item-desc">x${intercom.bonus} –º–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${intercom.cost === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : intercom.cost.toLocaleString() + ' üßÄ'}</div>
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            });
            document.getElementById('intercomsTab').innerHTML = intercomsHTML;

            // Sauces
            let saucesHTML = '';
            saucesList.forEach(sauce => {
                const owned = gameData.sauces.includes(sauce.id);
                const active = gameData.currentSauce === sauce.id;
                
                let buttonHTML = '';
                if (sauce.id === 'basic') {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-sauce="${sauce.id}">–í—ã–±—Ä–∞–Ω</button>`;
                } else if (owned) {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-sauce="${sauce.id}">${active ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å'}</button>`;
                } else {
                    buttonHTML = `<button class="buy-btn" data-buy-sauce="${sauce.id}" data-cost="${sauce.cost}">–ö—É–ø–∏—Ç—å</button>`;
                }
                
                saucesHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">${sauce.icon} ${sauce.name}</div>
                        </div>
                        <div class="shop-item-desc">+${sauce.bonus} —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${sauce.cost === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : sauce.cost.toLocaleString() + ' üßÄ'}</div>
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            });
            document.getElementById('sauceTab').innerHTML = saucesHTML;

            // Locations
            let locationsHTML = '';
            locationsList.forEach(location => {
                const active = gameData.currentLocation === location.id;
                const canUnlock = gameData.rebirths >= location.requiredRebirths;
                
                let buttonHTML = '';
                if (location.id === 'entrance') {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-location="${location.id}">–í—ã–±—Ä–∞–Ω–∞</button>`;
                } else if (active) {
                    buttonHTML = `<button class="select-btn active" data-select-location="${location.id}">–í—ã–±—Ä–∞–Ω–∞</button>`;
                } else if (!canUnlock) {
                    buttonHTML = `<button class="buy-btn" disabled>–ù—É–∂–Ω–æ ${location.requiredRebirths} ‚≠ê</button>`;
                } else {
                    buttonHTML = `<button class="select-btn" data-select-location="${location.id}">–í—ã–±—Ä–∞—Ç—å</button>`;
                }
                
                locationsHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">${location.icon} ${location.name}</div>
                        </div>
                        <div class="shop-item-desc">x${location.multiplier} | ${location.requiredRebirths} ‚≠ê</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${location.cost === 0 ? '–°–¢–ê–†–¢–û–í–ê–Ø' : location.cost.toLocaleString() + ' üßÄ'}</div>
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            });
            document.getElementById('locationsTab').innerHTML = locationsHTML;

            // Decorations
            const ownedDecorations = casesList
                .flatMap(c => c.items)
                .filter(i => gameData.inventory.decorations.includes(i.id));

            if (ownedDecorations.length > 0) {
                locationsHTML += `
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <h3 style="color: #fbbf24; margin-bottom: 15px; text-align: center;">–ú–æ–∏ —É–∫—Ä–∞—à–µ–Ω–∏—è</h3>
                `;

                ownedDecorations.forEach(decoration => {
                    const equipped = gameData.equipped.decoration === decoration.id;
                    
                    locationsHTML += `
                        <div class="shop-item">
                            <div class="shop-item-header">
                                <div class="shop-item-name">${decoration.icon} ${decoration.name}</div>
                                <div class="item-rarity rarity-${decoration.rarity}" style="font-size: 0.7em; padding: 3px 8px;">${getRarityName(decoration.rarity)}</div>
                            </div>
                            <div class="shop-item-footer">
                                <button class="select-btn ${equipped ? 'active' : ''}" data-equip-decoration="${decoration.id}">${equipped ? '–ù–∞–¥–µ—Ç–æ' : '–ù–∞–¥–µ—Ç—å'}</button>
                                ${equipped ? '<button class="buy-btn" style="background: #ef4444;" data-unequip-decoration="true">–°–Ω—è—Ç—å</button>' : ''}
                            </div>
                        </div>
                    `;
                });

                locationsHTML += '</div>';
            }

            document.getElementById('locationsTab').innerHTML = locationsHTML;
        }

        document.getElementById('intercom').addEventListener('click', function(event) {
            const clickPower = (gameData.clickPower + gameData.sauceBonus) * gameData.locationMultiplier;
            const bonusMultiplier = 1 + gameData.rebirths * 0.1;
            const totalGain = Math.floor(clickPower * bonusMultiplier);
            
            gameData.cheese += totalGain;
            gameData.totalCheese += totalGain;
            gameData.allTimeCheese += totalGain;

            const splash = document.createElement('div');
            splash.className = 'cheese-splash';
            splash.textContent = `+${totalGain.toLocaleString()} üßÄ`;
            splash.style.left = event.clientX + 'px';
            splash.style.top = event.clientY + 'px';
            splash.style.color = '#fbbf24';
            document.body.appendChild(splash);
            setTimeout(() => splash.remove(), 1500);

            updateUI();
            checkLevelUp();
        });

        function setupEventListeners() {
            document.addEventListener('click', function(e) {
                if (e.target.dataset.upgrade) {
                    const upgrade = upgradesList.find(u => u.id === e.target.dataset.upgrade);
                    if (!upgrade) return;

                    const level = gameData.upgrades[upgrade.id] || 0;
                    const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scale, level) * Math.pow(1.2, gameData.rebirths));

                    if (gameData.cheese >= cost) {
                        gameData.cheese -= cost;
                        gameData.upgrades[upgrade.id]++;

                        if (upgrade.type === 'click') {
                            gameData.clickPower += upgrade.power;
                        } else if (upgrade.type === 'auto') {
                            gameData.cheesePerSecond += upgrade.power;
                        }

                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.buyIntercom) {
                    const cost = parseInt(e.target.dataset.cost);
                    const type = e.target.dataset.buyIntercom;
                    
                    if (gameData.cheese >= cost && !gameData.intercoms.includes(type)) {
                        gameData.cheese -= cost;
                        gameData.intercoms.push(type);
                        
                        const intercom = intercomsList.find(i => i.id === type);
                        if (intercom) {
                            gameData.currentIntercom = type;
                            gameData.intercomBonus = intercom.bonus;
                            updateIntercomVisual(type);
                        }
                        
                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.selectIntercom) {
                    const type = e.target.dataset.selectIntercom;
                    gameData.currentIntercom = type;
                    const intercom = intercomsList.find(i => i.id === type);
                    if (intercom) {
                        gameData.intercomBonus = intercom.bonus;
                        updateIntercomVisual(type);
                    }
                    renderShop();
                    updateUI();
                    saveGame();
                } else if (e.target.dataset.buySauce) {
                    const cost = parseInt(e.target.dataset.cost);
                    const type = e.target.dataset.buySauce;
                    
                    if (gameData.cheese >= cost && !gameData.sauces.includes(type)) {
                        gameData.cheese -= cost;
                        gameData.sauces.push(type);
                        
                        const sauce = saucesList.find(s => s.id === type);
                        if (sauce) {
                            gameData.currentSauce = type;
                            gameData.sauceBonus = sauce.bonus;
                            updateSauceDisplay();
                        }
                        
                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.selectSauce) {
                    const type = e.target.dataset.selectSauce;
                    gameData.currentSauce = type;
                    const sauce = saucesList.find(s => s.id === type);
                    if (sauce) {
                        gameData.sauceBonus = sauce.bonus;
                        updateSauceDisplay();
                    }
                    renderShop();
                    updateUI();
                    saveGame();
                } else if (e.target.dataset.selectLocation) {
                    const type = e.target.dataset.selectLocation;
                    const location = locationsList.find(l => l.id === type);
                    
                    if (location && gameData.rebirths >= location.requiredRebirths) {
                        gameData.currentLocation = type;
                        gameData.locationMultiplier = location.multiplier;
                        updateLocationDisplay();
                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.equipDecoration) {
                    gameData.equipped.decoration = e.target.dataset.equipDecoration;
                    updateDecoration();
                    renderShop();
                    saveGame();
                } else if (e.target.dataset.unequipDecoration) {
                    gameData.equipped.decoration = null;
                    updateDecoration();
                    renderShop();
                    saveGame();
                }
            });

            document.querySelectorAll('.shop-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    document.getElementById('upgradesTab').classList.add('hidden');
                    document.getElementById('intercomsTab').classList.add('hidden');
                    document.getElementById('sauceTab').classList.add('hidden');
                    document.getElementById('locationsTab').classList.add('hidden');

                    if (this.dataset.tab === 'upgrades') {
                        document.getElementById('upgradesTab').classList.remove('hidden');
                    } else if (this.dataset.tab === 'intercoms') {
                        document.getElementById('intercomsTab').classList.remove('hidden');
                    } else if (this.dataset.tab === 'sauce') {
                        document.getElementById('sauceTab').classList.remove('hidden');
                    } else if (this.dataset.tab === 'locations') {
                        document.getElementById('locationsTab').classList.remove('hidden');
                    }
                });
            });

            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentLeaderboardTab = this.dataset.lbTab;
                    loadLeaderboard();
                });
            });

            document.getElementById('rebirthBtn').addEventListener('click', doRebirth);
        }

        function getRebirthCost() {
            return Math.floor(1000000 * Math.pow(5, gameData.rebirths));
        }

        function doRebirth() {
            const rebirthCost = getRebirthCost();
            if (gameData.cheese >= rebirthCost) {
                if (confirm(`–ü–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è? –í—Å–µ —Å–±—Ä–æ—Å–∏—Ç—Å—è.\n\n–ë–æ–Ω—É—Å: +10%\n–°–ª–µ–¥—É—é—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${(rebirthCost * 5).toLocaleString()} üßÄ`)) {
                    gameData.rebirths++;
                    gameData.cheese = 0;
                    gameData.totalCheese = 0;
                    gameData.level = 1;
                    gameData.clickPower = 1;
                    gameData.cheesePerSecond = 0;
                    
                    upgradesList.forEach(u => {
                        gameData.upgrades[u.id] = 0;
                    });
                    
                    gameData.intercoms = ['cyfral'];
                    gameData.currentIntercom = 'cyfral';
                    gameData.sauces = ['basic'];
                    gameData.currentSauce = 'basic';
                    gameData.intercomBonus = 1;
                    gameData.sauceBonus = 0;
                    
                    updateIntercomVisual('cyfral');
                    updateSauceDisplay();
                    renderShop();
                    updateUI();
                    saveGame();
                }
            }
        }

        function checkLevelUp() {
            const nextLevel = gameData.level * 5000;
            if (gameData.totalCheese >= nextLevel) {
                gameData.level++;
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('cheeseCount').textContent = Math.floor(gameData.cheese).toLocaleString();
            document.getElementById('levelDisplay').textContent = gameData.level;
            document.getElementById('rebirthCount').textContent = gameData.rebirths;
            document.getElementById('clickPower').textContent = Math.floor((gameData.clickPower + gameData.sauceBonus) * gameData.locationMultiplier).toLocaleString();
            
            const cps = Math.floor(gameData.cheesePerSecond * gameData.intercomBonus * (1 + gameData.rebirths * 0.1) * gameData.locationMultiplier);
            document.getElementById('cheesePerSec').textContent = cps.toLocaleString();

            document.getElementById('pvpWins').textContent = gameData.pvpWins;
            document.getElementById('pvpLosses').textContent = gameData.pvpLosses;

            const rebirthCost = getRebirthCost();
            document.getElementById('rebirthCost').textContent = rebirthCost.toLocaleString();
            
            document.getElementById('rebirthBtn').disabled = gameData.cheese < rebirthCost;
        }

        let currentLeaderboardTab = 'balance';

        async function loadLeaderboard() {
            const snapshot = await get(ref(database, 'leaderboard'));
            if (!snapshot.exists()) {
                document.getElementById('leaderboardList').innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
                return;
            }

            let leaders = Object.values(snapshot.val());

            if (currentLeaderboardTab === 'balance') {
                leaders.sort((a, b) => b.cheese - a.cheese);
            } else if (currentLeaderboardTab === 'pvp') {
                leaders.sort((a, b) => (b.pvpMMR || 1000) - (a.pvpMMR || 1000));
            } else if (currentLeaderboardTab === 'rebirths') {
                leaders.sort((a, b) => b.rebirths - a.rebirths);
            }

            leaders = leaders.slice(0, 10);
            
            const leaderboardHTML = leaders.map((leader, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                
                let scoreText = '';
                if (currentLeaderboardTab === 'balance') {
                    scoreText = `${Math.floor(leader.cheese || 0).toLocaleString()} üßÄ`;
                } else if (currentLeaderboardTab === 'pvp') {
                    const mmr = leader.pvpMMR || 1000;
                    const rank = getRankFromMMR(mmr);
                    scoreText = `${mmr} MMR`;
                } else {
                    scoreText = `‚≠ê ${leader.rebirths || 0}`;
                }
                
                return `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                        <div class="leaderboard-player">${leader.login}</div>
                        <div class="leaderboard-score">${scoreText}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('leaderboardList').innerHTML = leaderboardHTML;
        }

        function startGameLoop() {
            setInterval(() => {
                const cps = gameData.cheesePerSecond * gameData.intercomBonus * (1 + gameData.rebirths * 0.1) * gameData.locationMultiplier;
                gameData.cheese += cps / 10;
                gameData.totalCheese += cps / 10;
                gameData.allTimeCheese += cps / 10;
                updateUI();
                checkLevelUp();
            }, 100);

            setInterval(() => {
                saveGame();
            }, 10000);
        }
    </script>
</body>
</html>
