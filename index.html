<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßÄ SOysdomofon - PVP Edition üö™</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #0a0e27;
            background-image: 
                radial-gradient(at 0% 0%, rgba(30, 58, 138, 0.3) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(109, 40, 217, 0.3) 0px, transparent 50%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes cheeseFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-200px) rotate(360deg); opacity: 0; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px currentColor, 0 0 40px currentColor; }
            50% { box-shadow: 0 0 40px currentColor, 0 0 80px currentColor; }
        }

        @keyframes orbit {
            from { transform: rotate(0deg) translateX(150px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(150px) rotate(-360deg); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes snow {
            0% { transform: translateY(-10vh); }
            100% { transform: translateY(110vh); }
        }

        @keyframes fadeChange {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }

        @keyframes sauceAppear {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }

        @keyframes rankShine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        /* === AUTH SCREEN === */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.5);
            padding: 50px 40px;
            max-width: 450px;
            width: 100%;
            animation: slideIn 0.6s ease;
        }

        .auth-logo h1 {
            font-size: 2.8em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .auth-logo p {
            color: #94a3b8;
            text-align: center;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: #94a3b8;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #e2e8f0;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 16px;
            color: white;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #fbbf24;
            background: rgba(255, 255, 255, 0.08);
        }

        .auth-button {
            width: 100%;
            padding: 16px;
            border: none;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3);
        }

        .auth-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(251, 191, 36, 0.5);
        }

        .error-message, .success-message {
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideIn 0.3s ease;
            font-size: 14px;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #86efac;
        }

        /* === GAME SCREEN === */
        .game-screen {
            display: none;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 2em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .header-left p {
            color: #94a3b8;
            font-weight: 300;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        .logout-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.5);
        }

        .admin-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3);
        }

        .transfer-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }

        .pvp-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
            animation: pulse 2s infinite;
        }

        .global-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid #fbbf24;
            color: #fbbf24;
            padding: 50px 70px;
            border-radius: 30px;
            font-size: 2em;
            font-weight: 700;
            text-align: center;
            z-index: 10001;
            box-shadow: 0 30px 90px rgba(251, 191, 36, 0.5);
            max-width: 80%;
            animation: slideIn 0.5s ease;
        }

        .global-message .author {
            color: #f59e0b;
            font-size: 0.6em;
            margin-bottom: 15px;
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.5);
            color: white;
            padding: 20px;
            border-radius: 15px;
            z-index: 10000;
            animation: slideIn 0.5s ease;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .notification.success {
            border-color: rgba(34, 197, 94, 0.5);
        }

        .notification.error {
            border-color: rgba(239, 68, 68, 0.5);
        }

        /* === PVP ARENA === */
        .pvp-arena {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 20000;
            display: none;
        }

        .pvp-arena.active {
            display: flex;
            flex-direction: column;
        }

        .pvp-header {
            padding: 30px;
            background: rgba(15, 23, 42, 0.8);
            border-bottom: 2px solid rgba(251, 191, 36, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pvp-player-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .pvp-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: 900;
        }

        .pvp-stats {
            text-align: left;
        }

        .pvp-name {
            font-size: 1.3em;
            font-weight: 700;
        }

        .pvp-hits {
            font-size: 2em;
            font-weight: 900;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .pvp-battlefield {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .pvp-sauce {
            position: absolute;
            width: 80px;
            height: 80px;
            cursor: pointer;
            animation: sauceAppear 0.3s ease;
            transition: all 0.1s;
            font-size: 4em;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 0 20px currentColor);
        }

        .pvp-sauce:hover {
            transform: scale(1.2);
        }

        .pvp-sauce:active {
            transform: scale(0.9);
        }

        .pvp-timer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 0 0 30px #fbbf24;
            z-index: 1;
        }

        .pvp-result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 60px;
            border-radius: 30px;
            text-align: center;
            border: 3px solid;
            z-index: 2;
        }

        .pvp-result.win {
            border-color: #10b981;
        }

        .pvp-result.lose {
            border-color: #ef4444;
        }

        .pvp-result h2 {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 900;
        }

        .pvp-result.win h2 {
            color: #10b981;
        }

        .pvp-result.lose h2 {
            color: #ef4444;
        }

        .pvp-reward {
            font-size: 2em;
            margin: 20px 0;
            font-weight: 700;
            color: #fbbf24;
        }

        /* === RANK SYSTEM === */
        .rank-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
            text-transform: uppercase;
            background-size: 200% auto;
            animation: rankShine 3s linear infinite;
        }

        .rank-novice { background: linear-gradient(90deg, #71717a, #a1a1aa, #71717a); }
        .rank-bronze { background: linear-gradient(90deg, #d97706, #f59e0b, #d97706); }
        .rank-silver { background: linear-gradient(90deg, #71717a, #d4d4d8, #71717a); }
        .rank-gold { background: linear-gradient(90deg, #f59e0b, #fbbf24, #f59e0b); }
        .rank-platinum { background: linear-gradient(90deg, #3b82f6, #60a5fa, #3b82f6); }
        .rank-diamond { background: linear-gradient(90deg, #06b6d4, #22d3ee, #06b6d4); }
        .rank-master { background: linear-gradient(90deg, #8b5cf6, #a78bfa, #8b5cf6); }
        .rank-grandmaster { background: linear-gradient(90deg, #ef4444, #f87171, #ef4444); }

        /* === EVENT EFFECTS === */
        .event-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 60px;
            border-radius: 30px;
            z-index: 9999;
            text-align: center;
            border: 3px solid;
            animation: slideIn 0.7s ease;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.8);
        }

        .event-icon {
            font-size: 6em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        .event-title {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .event-multiplier {
            font-size: 3.5em;
            font-weight: 900;
            color: #fbbf24;
            margin: 20px 0;
            animation: pulse 1s infinite;
        }

        .event-indicator {
            position: fixed;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 30px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 9998;
            animation: float 3s ease-in-out infinite;
            border: 2px solid;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .event-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9997;
        }

        .star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px white;
            animation: twinkle 2s infinite;
        }

        .orbit-particle {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            animation: orbit 10s linear infinite;
            box-shadow: 0 0 30px currentColor;
        }

        .rainbow-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(255,0,0,0.15), rgba(255,154,0,0.15), rgba(208,222,33,0.15), 
                rgba(79,220,74,0.15), rgba(63,218,216,0.15), rgba(47,201,226,0.15), 
                rgba(28,127,238,0.15), rgba(95,21,242,0.15), rgba(186,12,248,0.15));
            animation: rainbow 3s linear infinite;
            pointer-events: none;
        }

        .snow-particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: snow linear infinite;
            box-shadow: 0 0 10px white;
        }

        /* === MODALS === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 2em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .close-modal {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: rotate(90deg);
        }

        .modal-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .modal-tab {
            flex: 1;
            min-width: 100px;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
        }

        .modal-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .admin-section h3 {
            color: #fbbf24;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .admin-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
        }

        .admin-input:focus {
            outline: none;
            border-color: #fbbf24;
        }

        .admin-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }

        .admin-button.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .admin-button.warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.3);
        }

        .admin-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .user-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .user-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
        }

        .user-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .event-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
        }

        .event-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .event-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #fbbf24;
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(251, 191, 36, 0.3);
        }

        .event-card .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .event-card .name {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .event-card .mult {
            color: #fbbf24;
            font-size: 1.3em;
            font-weight: 800;
        }

        /* === MAIN CONTENT === */
        .main-content {
            display: grid;
            grid-template-columns: 340px 1fr 360px;
            gap: 20px;
        }

        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* === STATS PANEL === */
        .stats-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
        }

        .stats-panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.85em;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .rebirth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .rebirth-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.5);
        }

        .rebirth-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* === GAME AREA === */
        .game-area {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
        }

        .cheese-counter {
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .location-indicator {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.2em;
        }

        .intercom-container {
            position: relative;
            display: inline-block;
            margin: 30px 0;
        }

        .intercom {
            width: 320px;
            height: 420px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            border: 3px solid;
            animation: fadeChange 0.6s ease;
        }

        .intercom:hover {
            transform: scale(1.08) rotate(2deg);
        }

        .intercom:active {
            transform: scale(0.95);
        }

        /* –†–ê–ó–ù–´–ï –°–¢–ò–õ–ò –î–û–ú–û–§–û–ù–û–í */
        .intercom.cyfral {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1e3a8a 100%);
            border-color: #3b82f6;
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4);
        }

        .intercom.metakom {
            background: linear-gradient(135deg, #065f46 0%, #047857 50%, #065f46 100%);
            border-color: #10b981;
            box-shadow: 0 20px 60px rgba(16, 185, 129, 0.4);
        }

        .intercom.vizit {
            background: linear-gradient(135deg, #7c2d12 0%, #9a3412 50%, #7c2d12 100%);
            border-color: #f97316;
            box-shadow: 0 20px 60px rgba(249, 115, 22, 0.4);
        }

        .intercom.eltis {
            background: linear-gradient(135deg, #6b21a8 0%, #7e22ce 50%, #6b21a8 100%);
            border-color: #a855f7;
            box-shadow: 0 20px 60px rgba(168, 85, 247, 0.4);
        }

        .intercom.stalker {
            background: linear-gradient(135deg, #991b1b 0%, #b91c1c 50%, #991b1b 100%);
            border-color: #ef4444;
            box-shadow: 0 20px 60px rgba(239, 68, 68, 0.4);
        }

        .intercom-screen {
            width: 85%;
            height: 32%;
            margin: 20px auto;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6em;
            font-weight: 800;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: inset 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .intercom.cyfral .intercom-screen { color: #1e3a8a; }
        .intercom.metakom .intercom-screen { color: #065f46; }
        .intercom.vizit .intercom-screen { color: #7c2d12; }
        .intercom.eltis .intercom-screen { color: #6b21a8; }
        .intercom.stalker .intercom-screen { color: #991b1b; }

        .intercom-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 25px;
        }

        .intercom-btn {
            width: 100%;
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .intercom-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .cheese-splash {
            position: fixed;
            pointer-events: none;
            font-size: 2.5em;
            animation: cheeseFloat 1.5s ease-out forwards;
            z-index: 9999;
            font-weight: 900;
            text-shadow: 0 0 20px currentColor;
        }

        .click-info {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: 700;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* === SHOP === */
        .shop-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shop-panel h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .shop-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .shop-tab {
            flex: 1;
            min-width: 80px;
            padding: 10px 5px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .shop-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .shop-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.5);
            transform: translateX(5px);
        }

        .shop-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .shop-item-name {
            font-weight: 700;
            font-size: 0.95em;
        }

        .shop-item-level {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
        }

        .shop-item-desc {
            color: #94a3b8;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .shop-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .shop-item-cost {
            font-size: 1.1em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .buy-btn, .select-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .buy-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        .buy-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }

        .buy-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .select-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }

        .select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
        }

        .select-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        /* === LEADERBOARD === */
        .leaderboard {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
        }

        .leaderboard h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }

        .leaderboard-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .leaderboard-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
        }

        .leaderboard-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(251, 191, 36, 0.3);
            transform: translateX(5px);
        }

        .leaderboard-rank {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.3em;
        }

        .leaderboard-rank.gold {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0a0e27;
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.5);
        }

        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(148, 163, 184, 0.5);
        }

        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(249, 115, 22, 0.5);
        }

        .leaderboard-rank:not(.gold):not(.silver):not(.bronze) {
            background: rgba(255, 255, 255, 0.1);
            color: #94a3b8;
        }

        .leaderboard-player {
            flex: 1;
            margin-left: 15px;
            font-weight: 700;
        }

        .leaderboard-score {
            font-weight: 800;
            font-size: 1.2em;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* === SCROLLBAR === */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .hidden {
            display: none !important;
        }

        textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            resize: vertical;
            min-height: 100px;
        }

        textarea:focus {
            outline: none;
            border-color: #fbbf24;
        }
    </style>
</head>
<body>

    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-logo">
                <h1>üßÄ SOysdomofon</h1>
                <p>PVP Edition - –ë–∏—Ç–≤–∞ –∑–∞ –°—ã—Ä</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">–í—Ö–æ–¥</button>
                <button class="auth-tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <div id="errorMessage" class="error-message hidden"></div>
            <div id="successMessage" class="success-message hidden"></div>

            <form id="authForm">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="loginInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
                </div>

                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>

                <button type="submit" class="auth-button" id="authButton">–í–û–ô–¢–ò</button>
            </form>
        </div>
    </div>

    <div id="gameScreen" class="game-screen">
        <div class="header">
            <div class="header-left">
                <h1>üßÄ SOysdomofon</h1>
                <p>–ò–≥—Ä–æ–∫: <span id="playerName"></span> | <span id="playerRank" class="rank-badge rank-novice">–ù–æ–≤–∏—á–æ–∫</span> | MMR: <span id="playerMMR">1000</span></p>
            </div>
            <div class="header-buttons">
                <button class="btn pvp-btn" id="pvpBtn">‚öîÔ∏è PVP –ê–†–ï–ù–ê</button>
                <button class="btn transfer-btn" id="transferBtn">üí∏ –ü–µ—Ä–µ–≤–æ–¥</button>
                <button class="btn admin-btn hidden" id="adminBtn">‚öôÔ∏è –ê–¥–º–∏–Ω</button>
                <button class="btn logout-btn" id="logoutBtn">–í—ã—Ö–æ–¥</button>
            </div>
        </div>

        <div class="main-content">
            <div class="stats-panel">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                
                <div class="stat-item">
                    <div class="stat-label">–¢–µ–∫—É—â–∞—è –ª–æ–∫–∞—Ü–∏—è</div>
                    <div class="stat-value" id="currentLocation" style="font-size: 1.3em;">üè† –ü–æ–¥—ä–µ–∑–¥</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –ª–æ–∫–∞—Ü–∏–∏</div>
                    <div class="stat-value">x<span id="locationMultiplier">1</span></div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">–°—ã—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥—É</div>
                    <div class="stat-value" id="cheesePerSec">0</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                    <div class="stat-value" id="levelDisplay">1</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                    <div class="stat-value" id="totalCheese">0</div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">PVP –ø–æ–±–µ–¥ / –ø–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                    <div class="stat-value" style="font-size: 1.3em;"><span id="pvpWins">0</span> / <span id="pvpLosses">0</span></div>
                </div>

                <div class="rebirth-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="stat-item">
                        <div class="stat-label">‚≠ê –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</div>
                        <div class="stat-value" id="rebirthCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                        <div class="stat-value">x<span id="rebirthBonus">1</span></div>
                    </div>
                    <button class="rebirth-btn" id="rebirthBtn">
                        ‚≠ê –ü–ï–†–ï–†–û–î–ò–¢–¨–°–Ø (<span id="rebirthCost">1,000,000</span> üßÄ)
                    </button>
                </div>
            </div>

            <div>
                <div class="game-area">
                    <div class="location-indicator" id="locationName">üè† –ü–æ–¥—ä–µ–∑–¥ (x1)</div>

                    <div class="cheese-counter">
                        üßÄ <span id="cheeseCount">0</span>
                    </div>

                    <div class="intercom-container">
                        <div class="intercom cyfral" id="intercom">
                            <div class="intercom-screen">
                                <span id="intercomName">CYFRAL</span>
                            </div>
                            <div class="intercom-buttons">
                                <div class="intercom-btn">1</div>
                                <div class="intercom-btn">2</div>
                                <div class="intercom-btn">3</div>
                                <div class="intercom-btn">4</div>
                                <div class="intercom-btn">5</div>
                                <div class="intercom-btn">6</div>
                                <div class="intercom-btn">7</div>
                                <div class="intercom-btn">8</div>
                                <div class="intercom-btn">9</div>
                                <div class="intercom-btn">*</div>
                                <div class="intercom-btn">0</div>
                                <div class="intercom-btn">#</div>
                            </div>
                        </div>
                    </div>

                    <div class="click-info">
                        ‚ö° +<span id="clickPower">1</span> —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫ | <span id="currentSauce">üßÄ –°—ã—Ä</span>
                    </div>
                </div>

                <div class="leaderboard">
                    <h2>üèÜ –¢–æ–ø –ò–≥—Ä–æ–∫–æ–≤</h2>
                    
                    <div class="leaderboard-tabs">
                        <button class="leaderboard-tab active" data-lb-tab="balance">–ü–æ –±–∞–ª–∞–Ω—Å—É</button>
                        <button class="leaderboard-tab" data-lb-tab="pvp">PVP —Ä–µ–π—Ç–∏–Ω–≥</button>
                        <button class="leaderboard-tab" data-lb-tab="rebirths">–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</button>
                    </div>

                    <div id="leaderboardList">
                        <div style="text-align: center; color: #94a3b8; padding: 20px;">
                            –ó–∞–≥—Ä—É–∑–∫–∞...
                        </div>
                    </div>
                </div>
            </div>

            <div class="shop-panel">
                <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>

                <div class="shop-tabs">
                    <button class="shop-tab active" data-tab="upgrades">–£–ª—É—á—à–µ–Ω–∏—è</button>
                    <button class="shop-tab" data-tab="intercoms">–î–æ–º–æ—Ñ–æ–Ω—ã</button>
                    <button class="shop-tab" data-tab="sauce">–°–æ—É—Å—ã</button>
                    <button class="shop-tab" data-tab="locations">–õ–æ–∫–∞—Ü–∏–∏</button>
                </div>

                <div id="upgradesTab" class="shop-content"></div>
                <div id="intercomsTab" class="shop-content hidden"></div>
                <div id="sauceTab" class="shop-content hidden"></div>
                <div id="locationsTab" class="shop-content hidden"></div>
            </div>
        </div>
    </div>

    <!-- PVP ARENA -->
    <div id="pvpArena" class="pvp-arena">
        <div class="pvp-header">
            <div class="pvp-player-info">
                <div class="pvp-avatar">üë§</div>
                <div class="pvp-stats">
                    <div class="pvp-name" id="pvpPlayer1Name">–í—ã</div>
                    <div class="pvp-hits">–•–∏—Ç—ã: <span id="pvpPlayer1Hits">0</span></div>
                </div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2em; font-weight: 900; color: #fbbf24;">‚öîÔ∏è</div>
                <div style="font-size: 1.5em; font-weight: 700;">–°—Ç–∞–≤–∫–∞: <span id="pvpBet">0</span> üßÄ</div>
            </div>
            <div class="pvp-player-info">
                <div class="pvp-stats" style="text-align: right;">
                    <div class="pvp-name" id="pvpPlayer2Name">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</div>
                    <div class="pvp-hits">–•–∏—Ç—ã: <span id="pvpPlayer2Hits">0</span></div>
                </div>
                <div class="pvp-avatar">ü§ñ</div>
            </div>
        </div>
        <div class="pvp-battlefield" id="pvpBattlefield">
            <div class="pvp-timer" id="pvpTimer">3</div>
        </div>
    </div>

    <div id="transferModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üí∏ –ü–µ—Ä–µ–≤–æ–¥</h2>
                <button class="close-modal" onclick="closeTransferModal()">√ó</button>
            </div>
            <div class="admin-section">
                <input type="text" class="admin-input" id="transferRecipient" placeholder="–õ–æ–≥–∏–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                <input type="number" class="admin-input" id="transferAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã—Ä–∞">
                <button class="admin-button" onclick="sendTransfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="pvpModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚öîÔ∏è PVP –ê—Ä–µ–Ω–∞</h2>
                <button class="close-modal" onclick="closePVPModal()">√ó</button>
            </div>
            <div class="admin-section">
                <h3>–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">–†–∞–Ω–≥</div>
                        <div id="pvpModalRank" class="rank-badge rank-novice" style="font-size: 1.1em;">–ù–æ–≤–∏—á–æ–∫</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">MMR</div>
                        <div style="font-size: 1.8em; font-weight: 800; color: #fbbf24;"><span id="pvpModalMMR">1000</span></div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">–ü–æ–±–µ–¥</div>
                        <div style="font-size: 1.8em; font-weight: 800; color: #10b981;"><span id="pvpModalWins">0</span></div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="color: #94a3b8; font-size: 0.9em; margin-bottom: 5px;">–ü–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                        <div style="font-size: 1.8em; font-weight: 800; color: #ef4444;"><span id="pvpModalLosses">0</span></div>
                    </div>
                </div>

                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <button class="admin-button" onclick="startPVP(1000)">1,000 üßÄ</button>
                    <button class="admin-button" onclick="startPVP(5000)">5,000 üßÄ</button>
                    <button class="admin-button" onclick="startPVP(10000)">10,000 üßÄ</button>
                    <button class="admin-button" onclick="startPVP(50000)">50,000 üßÄ</button>
                    <button class="admin-button" onclick="startPVP(100000)">100,000 üßÄ</button>
                    <button class="admin-button" onclick="startPVP(500000)">500,000 üßÄ</button>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px;">
                    <div style="font-weight: 700; margin-bottom: 10px;">‚öîÔ∏è –ü—Ä–∞–≤–∏–ª–∞ PVP:</div>
                    <div style="font-size: 0.9em; color: #94a3b8; line-height: 1.6;">
                        ‚Ä¢ –ù–∞ —ç–∫—Ä–∞–Ω–µ –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ—É—Å—ã<br>
                        ‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –ø–æ –Ω–∏–º –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞<br>
                        ‚Ä¢ –ö—Ç–æ –ø–µ—Ä–≤—ã–º –Ω–∞–Ω–µ—Å–µ—Ç 20 —Ö–∏—Ç–æ–≤ - –ø–æ–±–µ–∂–¥–∞–µ—Ç<br>
                        ‚Ä¢ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∑–∞–±–∏—Ä–∞–µ—Ç –æ–±–µ —Å—Ç–∞–≤–∫–∏<br>
                        ‚Ä¢ –ó–∞ –ø–æ–±–µ–¥—É/–ø–æ—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è MMR
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h2>
                <button class="close-modal" onclick="closeAdminModal()">√ó</button>
            </div>

            <div class="modal-tabs">
                <button class="modal-tab active" data-admin-tab="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button class="modal-tab" data-admin-tab="player">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
                <button class="modal-tab" data-admin-tab="broadcast">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                <button class="modal-tab" data-admin-tab="events">–ï–≤–µ–Ω—Ç—ã</button>
            </div>

            <div id="usersAdminTab" class="admin-tab-content"></div>
            <div id="playerAdminTab" class="admin-tab-content hidden"></div>
            <div id="broadcastAdminTab" class="admin-tab-content hidden"></div>
            <div id="eventsAdminTab" class="admin-tab-content hidden"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const app = initializeApp({
            databaseURL: "https://sirnik-3356a-default-rtdb.firebaseio.com/"
        });
        const database = getDatabase(app);

        let currentUser = null;
        let isAuthMode = true;
        let currentEventMultiplier = 1;
        let currentEventData = null;
        let gameData = {
            cheese: 0,
            totalCheese: 0,
            allTimeCheese: 0,
            level: 1,
            rebirths: 0,
            clickPower: 1,
            cheesePerSecond: 0,
            upgrades: {},
            intercoms: ['cyfral'],
            currentIntercom: 'cyfral',
            sauces: ['basic'],
            currentSauce: 'basic',
            intercomBonus: 1,
            sauceBonus: 0,
            isAdmin: false,
            isBanned: false,
            currentLocation: 'entrance',
            locationMultiplier: 1,
            pvpWins: 0,
            pvpLosses: 0,
            pvpMMR: 1000
        };

        const upgradesList = [
            { id: 'finger', name: 'üëÜ –°–∏–ª—å–Ω—ã–π –ø–∞–ª–µ—Ü', desc: '+1 —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫', baseCost: 50, type: 'click', power: 1, scale: 1.5 },
            { id: 'glove', name: 'üß§ –ü–µ—Ä—á–∞—Ç–∫–∞', desc: '+3 —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫', baseCost: 250, type: 'click', power: 3, scale: 1.5 },
            { id: 'brush2', name: 'üñåÔ∏è –ö–∏—Å—Ç–æ—á–∫–∞', desc: '+8 —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫', baseCost: 1000, type: 'click', power: 8, scale: 1.6 },
            { id: 'roller', name: 'üé® –í–∞–ª–∏–∫', desc: '+20 —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫', baseCost: 5000, type: 'click', power: 20, scale: 1.6 },
            { id: 'sprayer', name: 'üíß –ü—É–ª—å–≤–µ—Ä–∏–∑–∞—Ç–æ—Ä', desc: '+50 —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫', baseCost: 25000, type: 'click', power: 50, scale: 1.7 },
            { id: 'bucket', name: 'ü™£ –í–µ–¥—Ä–æ', desc: '+150 —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫', baseCost: 100000, type: 'click', power: 150, scale: 1.7 },
            { id: 'auto', name: 'ü§ñ –†–æ–±–æ—Ç', desc: '+1 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 100, type: 'auto', power: 1, scale: 1.7 },
            { id: 'sponge', name: 'üßΩ –ì—É–±–∫–∞', desc: '+5 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 500, type: 'auto', power: 5, scale: 1.7 },
            { id: 'drone', name: 'üöÅ –î—Ä–æ–Ω', desc: '+15 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 2500, type: 'auto', power: 15, scale: 1.8 },
            { id: 'brush', name: 'üñåÔ∏è –ê–≤—Ç–æ-–∫–∏—Å—Ç—å', desc: '+50 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 10000, type: 'auto', power: 50, scale: 1.8 },
            { id: 'spray', name: 'üí¶ –†–∞—Å–ø—ã–ª–∏—Ç–µ–ª—å', desc: '+150 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 50000, type: 'auto', power: 150, scale: 1.9 },
            { id: 'machine', name: '‚öôÔ∏è –ú–∞—à–∏–Ω–∞', desc: '+500 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 250000, type: 'auto', power: 500, scale: 1.9 },
            { id: 'gun', name: 'üî´ –ü—É—à–∫–∞', desc: '+1500 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 1000000, type: 'auto', power: 1500, scale: 2.0 },
            { id: 'factory', name: 'üè≠ –§–∞–±—Ä–∏–∫–∞', desc: '+5000 —Å—ã—Ä–∞/—Å–µ–∫', baseCost: 5000000, type: 'auto', power: 5000, scale: 2.1 },
        ];

        const intercomsList = [
            { id: 'cyfral', name: 'CYFRAL', bonus: 1.0, cost: 0 },
            { id: 'metakom', name: '–ú–ï–¢–ê–ö–û–ú', bonus: 1.15, cost: 25000 },
            { id: 'vizit', name: 'VIZIT', bonus: 1.35, cost: 100000 },
            { id: 'eltis', name: 'ELTIS', bonus: 1.60, cost: 500000 },
            { id: 'stalker', name: '–°–¢–ê–õ–ö–ï–†', bonus: 2.0, cost: 2500000 },
        ];

        const saucesList = [
            { id: 'basic', name: '–°—ã—Ä', icon: 'üßÄ', bonus: 0, cost: 0 },
            { id: 'mayo', name: '–ú–∞–π–æ–Ω–µ–∑', icon: 'ü•õ', bonus: 10, cost: 15000 },
            { id: 'ketchup', name: '–ö–µ—Ç—á—É–ø', icon: 'üçÖ', bonus: 30, cost: 75000 },
            { id: 'mustard', name: '–ì–æ—Ä—á–∏—Ü–∞', icon: 'üå≠', bonus: 100, cost: 400000 },
            { id: 'soy', name: '–°–æ–µ–≤—ã–π', icon: 'üç∂', bonus: 300, cost: 2000000 },
            { id: 'bbq', name: '–ë–∞—Ä–±–µ–∫—é', icon: 'üçñ', bonus: 1000, cost: 10000000 },
            { id: 'honey', name: '–ú–µ–¥–æ–≤—ã–π', icon: 'üçØ', bonus: 3000, cost: 50000000 },
            { id: 'chili', name: '–ß–∏–ª–∏', icon: 'üå∂Ô∏è', bonus: 10000, cost: 250000000 },
        ];

        const locationsList = [
            { id: 'entrance', name: '–ü–æ–¥—ä–µ–∑–¥', icon: 'üè†', multiplier: 1.0, cost: 0, requiredRebirths: 0 },
            { id: 'district', name: '–†–∞–π–æ–Ω', icon: 'üèòÔ∏è', multiplier: 1.5, cost: 100000, requiredRebirths: 1 },
            { id: 'city', name: '–ì–æ—Ä–æ–¥', icon: 'üèôÔ∏è', multiplier: 2.0, cost: 1000000, requiredRebirths: 3 },
            { id: 'megapolis', name: '–ú–µ–≥–∞–ø–æ–ª–∏—Å', icon: 'üåÜ', multiplier: 3.0, cost: 10000000, requiredRebirths: 5 },
            { id: 'country', name: '–°—Ç—Ä–∞–Ω–∞', icon: 'üó∫Ô∏è', multiplier: 5.0, cost: 100000000, requiredRebirths: 10 },
            { id: 'continent', name: '–ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç', icon: 'üåç', multiplier: 8.0, cost: 1000000000, requiredRebirths: 20 },
            { id: 'planet', name: '–ü–ª–∞–Ω–µ—Ç–∞', icon: 'üåé', multiplier: 15.0, cost: 10000000000, requiredRebirths: 35 },
            { id: 'galaxy', name: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', icon: 'üåå', multiplier: 25.0, cost: 100000000000, requiredRebirths: 50 },
        ];

        const eventsList = [
            { id: 'double', name: '–î–≤–æ–π–Ω–æ–π —Å—ã—Ä', icon: 'üßÄüßÄ', multiplier: 2, color: '#fbbf24', effect: 'normal' },
            { id: 'triple', name: '–¢—Ä–æ–π–Ω–æ–π —Å—ã—Ä', icon: 'üßÄ√ó3', multiplier: 3, color: '#f59e0b', effect: 'normal' },
            { id: 'mega', name: '–ú–µ–≥–∞ –±–æ–Ω—É—Å', icon: 'üí∞', multiplier: 5, color: '#d97706', effect: 'rainbow' },
            { id: 'ultra', name: '–£–ª—å—Ç—Ä–∞ –±–æ–Ω—É—Å', icon: 'üåü', multiplier: 10, color: '#f1c40f', effect: 'stars' },
            { id: 'cosmic', name: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π', icon: 'üåå', multiplier: 15, color: '#9b59b6', effect: 'cosmic' },
            { id: 'nuclear', name: '–Ø–¥–µ—Ä–Ω—ã–π', icon: '‚ò¢Ô∏è', multiplier: 20, color: '#10b981', effect: 'fireworks' },
            { id: 'quantum', name: '–ö–≤–∞–Ω—Ç–æ–≤—ã–π', icon: '‚öõÔ∏è', multiplier: 25, color: '#3b82f6', effect: 'cosmic' },
            { id: 'infinity', name: '–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å', icon: '‚àû', multiplier: 50, color: '#8b5cf6', effect: 'rainbow' },
            { id: 'godmode', name: '–†–µ–∂–∏–º –±–æ–≥–∞', icon: 'üëë', multiplier: 100, color: '#ef4444', effect: 'fireworks' },
        ];

        const rankThresholds = [
            { name: '–ù–æ–≤–∏—á–æ–∫', mmr: 0, class: 'rank-novice' },
            { name: '–ë—Ä–æ–Ω–∑–∞', mmr: 1200, class: 'rank-bronze' },
            { name: '–°–µ—Ä–µ–±—Ä–æ', mmr: 1400, class: 'rank-silver' },
            { name: '–ó–æ–ª–æ—Ç–æ', mmr: 1600, class: 'rank-gold' },
            { name: '–ü–ª–∞—Ç–∏–Ω–∞', mmr: 1800, class: 'rank-platinum' },
            { name: '–ê–ª–º–∞–∑', mmr: 2000, class: 'rank-diamond' },
            { name: '–ú–∞—Å—Ç–µ—Ä', mmr: 2300, class: 'rank-master' },
            { name: '–ì—Ä–∞–Ω–¥-–ú–∞—Å—Ç–µ—Ä', mmr: 2600, class: 'rank-grandmaster' },
        ];

        function getRankFromMMR(mmr) {
            for (let i = rankThresholds.length - 1; i >= 0; i--) {
                if (mmr >= rankThresholds[i].mmr) {
                    return rankThresholds[i];
                }
            }
            return rankThresholds[0];
        }

        upgradesList.forEach(u => {
            if (gameData.upgrades[u.id] === undefined) {
                gameData.upgrades[u.id] = 0;
            }
        });

        const savedUser = localStorage.getItem('soysdomofon_user');
        if (savedUser) {
            currentUser = savedUser;
            loadGameData();
        }

        onValue(ref(database, 'globalMessage'), (snapshot) => {
            const data = snapshot.val();
            if (data && data.message && data.timestamp > Date.now() - 10000) {
                showGlobalMessage(data.author, data.message);
            }
        });

        onValue(ref(database, 'activeEvent'), (snapshot) => {
            const data = snapshot.val();
            if (data && data.endTime > Date.now()) {
                activateEvent(data);
            } else {
                deactivateEvent();
            }
        });

        if (currentUser) {
            onValue(ref(database, 'transfers/' + currentUser), async (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    for (let key in data) {
                        const transfer = data[key];
                        if (!transfer.processed) {
                            gameData.cheese += transfer.amount;
                            gameData.totalCheese += transfer.amount;
                            gameData.allTimeCheese += transfer.amount;
                            
                            showNotification(`–ü–æ–ª—É—á–µ–Ω –ø–µ—Ä–µ–≤–æ–¥ ${transfer.amount.toLocaleString()} üßÄ –æ—Ç ${transfer.from}`, 'success');
                            
                            await update(ref(database, `transfers/${currentUser}/${key}`), { processed: true });
                            updateUI();
                            saveGame();
                        }
                    }
                }
            });
        }

        document.getElementById('loginTab').addEventListener('click', function() {
            isAuthMode = true;
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('authButton').textContent = '–í–û–ô–¢–ò';
        });

        document.getElementById('registerTab').addEventListener('click', function() {
            isAuthMode = false;
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('authButton').textContent = '–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø';
        });

        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const login = document.getElementById('loginInput').value.trim();
            const password = document.getElementById('passwordInput').value;

            if (!login || !password || login.length < 3 || password.length < 6) {
                showError('–õ–æ–≥–∏–Ω >= 3 —Å–∏–º–≤–æ–ª–æ–≤, –ø–∞—Ä–æ–ª—å >= 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }

            const userRef = ref(database, 'users/' + login);

            try {
                const snapshot = await get(userRef);

                if (isAuthMode) {
                    if (!snapshot.exists()) {
                        showError('–ê–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }

                    const userData = snapshot.val();
                    if (userData.password !== password) {
                        showError('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                        return;
                    }

                    if (userData.gameData && userData.gameData.isBanned) {
                        showError('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                        return;
                    }

                    currentUser = login;
                    localStorage.setItem('soysdomofon_user', login);
                    showSuccess('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
                    setTimeout(() => loadGameData(), 500);

                } else {
                    if (snapshot.exists()) {
                        showError('–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç!');
                        return;
                    }

                    gameData.isAdmin = login === 'qwenixDev01';

                    await set(userRef, {
                        password: password,
                        login: login,
                        gameData: gameData,
                        createdAt: Date.now()
                    });

                    currentUser = login;
                    localStorage.setItem('soysdomofon_user', login);
                    showSuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                    setTimeout(() => loadGameData(), 500);
                }
            } catch (error) {
                console.error(error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        });

        function showError(msg) {
            const div = document.getElementById('errorMessage');
            div.textContent = msg;
            div.classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            setTimeout(() => div.classList.add('hidden'), 5000);
        }

        function showSuccess(msg) {
            const div = document.getElementById('successMessage');
            div.textContent = msg;
            div.classList.remove('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            setTimeout(() => div.classList.add('hidden'), 3000);
        }

        async function loadGameData() {
            const snapshot = await get(ref(database, 'users/' + currentUser));

            if (snapshot.exists()) {
                const data = snapshot.val();
                const loadedData = data.gameData || {};
                
                gameData = {
                    ...gameData,
                    ...loadedData,
                    upgrades: loadedData.upgrades || {}
                };

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è PVP
                if (gameData.pvpMMR === undefined) gameData.pvpMMR = 1000;
                if (gameData.pvpWins === undefined) gameData.pvpWins = 0;
                if (gameData.pvpLosses === undefined) gameData.pvpLosses = 0;
                if (gameData.currentLocation === undefined) gameData.currentLocation = 'entrance';
                if (gameData.locationMultiplier === undefined) gameData.locationMultiplier = 1;

                if (gameData.isBanned) {
                    alert('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                    localStorage.removeItem('soysdomofon_user');
                    location.reload();
                    return;
                }
                
                upgradesList.forEach(u => {
                    if (gameData.upgrades[u.id] === undefined) {
                        gameData.upgrades[u.id] = 0;
                    }
                });
                
                document.getElementById('playerName').textContent = currentUser;

                const rank = getRankFromMMR(gameData.pvpMMR);
                const rankBadge = document.getElementById('playerRank');
                rankBadge.textContent = rank.name;
                rankBadge.className = 'rank-badge ' + rank.class;
                document.getElementById('playerMMR').textContent = gameData.pvpMMR;

                if (gameData.isAdmin || currentUser === 'qwenixDev01') {
                    gameData.isAdmin = true;
                    document.getElementById('adminBtn').classList.remove('hidden');
                }
            }

            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            updateIntercomVisual(gameData.currentIntercom);
            updateLocationDisplay();
            renderShop();
            updateUI();
            startGameLoop();
            loadLeaderboard();
            setupEventListeners();
        }

        function updateIntercomVisual(intercomId) {
            const intercomEl = document.getElementById('intercom');
            intercomEl.className = 'intercom ' + intercomId;
            
            const intercom = intercomsList.find(i => i.id === intercomId);
            if (intercom) {
                document.getElementById('intercomName').textContent = intercom.name;
            }
        }

        function updateLocationDisplay() {
            const location = locationsList.find(l => l.id === gameData.currentLocation);
            if (location) {
                document.getElementById('currentLocation').textContent = `${location.icon} ${location.name}`;
                document.getElementById('locationName').textContent = `${location.icon} ${location.name} (x${location.multiplier})`;
                document.getElementById('locationMultiplier').textContent = location.multiplier;
                gameData.locationMultiplier = location.multiplier;
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', async function() {
            await saveGame();
            localStorage.removeItem('soysdomofon_user');
            location.reload();
        });

        document.getElementById('transferBtn').addEventListener('click', function() {
            document.getElementById('transferModal').classList.add('active');
        });

        document.getElementById('pvpBtn').addEventListener('click', function() {
            document.getElementById('pvpModal').classList.add('active');
            
            const rank = getRankFromMMR(gameData.pvpMMR);
            const rankBadge = document.getElementById('pvpModalRank');
            rankBadge.textContent = rank.name;
            rankBadge.className = 'rank-badge ' + rank.class;
            
            document.getElementById('pvpModalMMR').textContent = gameData.pvpMMR;
            document.getElementById('pvpModalWins').textContent = gameData.pvpWins;
            document.getElementById('pvpModalLosses').textContent = gameData.pvpLosses;
        });

        document.getElementById('adminBtn').addEventListener('click', function() {
            openAdminPanel();
        });

        window.closeTransferModal = function() {
            document.getElementById('transferModal').classList.remove('active');
        };

        window.closePVPModal = function() {
            document.getElementById('pvpModal').classList.remove('active');
        };

        window.closeAdminModal = function() {
            document.getElementById('adminModal').classList.remove('active');
        };

        window.sendTransfer = async function() {
            const recipient = document.getElementById('transferRecipient').value.trim();
            const amount = parseInt(document.getElementById('transferAmount').value);

            if (!recipient || !amount || amount <= 0 || amount > gameData.cheese || recipient === currentUser) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'error');
                return;
            }

            const recipientSnapshot = await get(ref(database, 'users/' + recipient));
            if (!recipientSnapshot.exists()) {
                showNotification('–ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            gameData.cheese -= amount;
            
            const transferId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            await set(ref(database, `transfers/${recipient}/${transferId}`), {
                from: currentUser,
                amount: amount,
                timestamp: Date.now(),
                processed: false
            });

            showNotification(`–ü–µ—Ä–µ–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`, 'success');
            updateUI();
            saveGame();
            closeTransferModal();
            
            document.getElementById('transferRecipient').value = '';
            document.getElementById('transferAmount').value = '';
        };

        // PVP –°–ò–°–¢–ï–ú–ê
        let pvpGameState = {
            active: false,
            bet: 0,
            player1Hits: 0,
            player2Hits: 0,
            countdown: 3,
            botDifficulty: 0.7
        };

        window.startPVP = async function(bet) {
            if (gameData.cheese < bet) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—ã—Ä–∞ –¥–ª—è —Å—Ç–∞–≤–∫–∏', 'error');
                return;
            }

            gameData.cheese -= bet;
            updateUI();
            saveGame();

            closePVPModal();

            pvpGameState = {
                active: true,
                bet: bet,
                player1Hits: 0,
                player2Hits: 0,
                countdown: 3,
                botDifficulty: 0.7 + (gameData.pvpMMR - 1000) / 5000
            };

            document.getElementById('pvpArena').classList.add('active');
            document.getElementById('pvpPlayer1Name').textContent = currentUser;
            document.getElementById('pvpPlayer2Name').textContent = '–ë–æ—Ç';
            document.getElementById('pvpBet').textContent = (bet * 2).toLocaleString();
            document.getElementById('pvpPlayer1Hits').textContent = '0';
            document.getElementById('pvpPlayer2Hits').textContent = '0';

            await countdownPVP();
            startPVPGame();
        };

        async function countdownPVP() {
            const timer = document.getElementById('pvpTimer');
            
            for (let i = 3; i > 0; i--) {
                timer.textContent = i;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            timer.textContent = '–ë–û–ô!';
            await new Promise(resolve => setTimeout(resolve, 500));
            timer.style.display = 'none';
        }

        function startPVPGame() {
            spawnPVPSauce();
        }

        function spawnPVPSauce() {
            if (!pvpGameState.active) return;

            const battlefield = document.getElementById('pvpBattlefield');
            const sauce = document.createElement('div');
            sauce.className = 'pvp-sauce';
            
            const randomSauce = saucesList[Math.floor(Math.random() * saucesList.length)];
            sauce.textContent = randomSauce.icon;
            
            const maxX = battlefield.clientWidth - 80;
            const maxY = battlefield.clientHeight - 80;
            sauce.style.left = Math.random() * maxX + 'px';
            sauce.style.top = Math.random() * maxY + 'px';

            sauce.addEventListener('click', function() {
                if (!pvpGameState.active) return;
                
                pvpGameState.player1Hits++;
                document.getElementById('pvpPlayer1Hits').textContent = pvpGameState.player1Hits;
                sauce.remove();

                if (pvpGameState.player1Hits >= 20) {
                    endPVP(true);
                    return;
                }

                setTimeout(() => spawnPVPSauce(), 300);
            });

            battlefield.appendChild(sauce);

            // –ë–æ—Ç –∫–ª–∏–∫–∞–µ—Ç —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é
            setTimeout(() => {
                if (sauce.parentElement && pvpGameState.active && Math.random() < pvpGameState.botDifficulty) {
                    pvpGameState.player2Hits++;
                    document.getElementById('pvpPlayer2Hits').textContent = pvpGameState.player2Hits;
                    sauce.remove();

                    if (pvpGameState.player2Hits >= 20) {
                        endPVP(false);
                        return;
                    }

                    setTimeout(() => spawnPVPSauce(), 300);
                }
            }, 200 + Math.random() * 300);
        }

        async function endPVP(playerWon) {
            pvpGameState.active = false;

            const battlefield = document.getElementById('pvpBattlefield');
            battlefield.innerHTML = '';

            const result = document.createElement('div');
            result.className = 'pvp-result ' + (playerWon ? 'win' : 'lose');
            
            const reward = pvpGameState.bet * 2;
            const mmrChange = playerWon ? Math.floor(20 + Math.random() * 10) : -Math.floor(15 + Math.random() * 10);

            if (playerWon) {
                gameData.cheese += reward;
                gameData.pvpWins++;
                gameData.pvpMMR += mmrChange;
                
                result.innerHTML = `
                    <h2>üéâ –ü–û–ë–ï–î–ê!</h2>
                    <div class="pvp-reward">+${reward.toLocaleString()} üßÄ</div>
                    <div style="font-size: 1.5em; color: #10b981;">MMR: ${mmrChange > 0 ? '+' : ''}${mmrChange}</div>
                    <div style="margin-top: 20px;">
                        <button class="admin-button" onclick="closePVPArena()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
            } else {
                gameData.pvpLosses++;
                gameData.pvpMMR += mmrChange;
                
                result.innerHTML = `
                    <h2>üíÄ –ü–û–†–ê–ñ–ï–ù–ò–ï</h2>
                    <div class="pvp-reward">-${pvpGameState.bet.toLocaleString()} üßÄ</div>
                    <div style="font-size: 1.5em; color: #ef4444;">MMR: ${mmrChange}</div>
                    <div style="margin-top: 20px;">
                        <button class="admin-button" onclick="closePVPArena()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–≥
            const rank = getRankFromMMR(gameData.pvpMMR);
            const rankBadge = document.getElementById('playerRank');
            rankBadge.textContent = rank.name;
            rankBadge.className = 'rank-badge ' + rank.class;
            document.getElementById('playerMMR').textContent = gameData.pvpMMR;

            battlefield.appendChild(result);
            updateUI();
            await saveGame();
        }

        window.closePVPArena = function() {
            document.getElementById('pvpArena').classList.remove('active');
            document.getElementById('pvpBattlefield').innerHTML = '<div class="pvp-timer" id="pvpTimer">3</div>';
            document.getElementById('pvpTimer').style.display = 'block';
        };

        function showNotification(msg, type = 'success') {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = msg;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 5000);
        }

        function showGlobalMessage(author, message) {
            const msg = document.createElement('div');
            msg.className = 'global-message';
            msg.innerHTML = `<div class="author">${author}</div><div>${message}</div>`;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 10000);
        }

        async function openAdminPanel() {
            document.getElementById('adminModal').classList.add('active');
            await loadUsersAdmin();
            renderPlayerManagementTab();
            renderBroadcastTab();
            renderEventsTab();
        }

        async function loadUsersAdmin() {
            const snapshot = await get(ref(database, 'users'));
            
            let html = '<div class="user-list">';
            
            if (snapshot.exists()) {
                const users = snapshot.val();
                for (let login in users) {
                    const user = users[login];
                    const userData = user.gameData || {};
                    const isBanned = userData.isBanned || false;
                    
                    html += `
                        <div class="user-item ${isBanned ? 'banned' : ''}">
                            <div style="flex: 1;">
                                <strong>${login}</strong><br>
                                <small>–ë–∞–ª–∞–Ω—Å: ${Math.floor(userData.cheese || 0).toLocaleString()} üßÄ</small><br>
                                <small>MMR: ${userData.pvpMMR || 1000} | –ü–æ–±–µ–¥: ${userData.pvpWins || 0}</small>
                                ${isBanned ? '<br><span style="color: #fca5a5;">–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù</span>' : ''}
                                ${userData.isAdmin ? '<br><span style="color: #fbbf24;">–ê–î–ú–ò–ù</span>' : ''}
                            </div>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <button class="admin-button" style="font-size: 11px; padding: 6px 10px;" onclick="viewUserLogs('${login}')">–õ–æ–≥–∏</button>
                                ${!userData.isAdmin ? `<button class="admin-button" style="font-size: 11px; padding: 6px 10px;" onclick="toggleAdmin('${login}', true)">–ê–¥–º–∏–Ω</button>` : `<button class="admin-button danger" style="font-size: 11px; padding: 6px 10px;" onclick="toggleAdmin('${login}', false)">-–ê–¥–º–∏–Ω</button>`}
                                ${!isBanned ? `<button class="admin-button danger" style="font-size: 11px; padding: 6px 10px;" onclick="banUser('${login}')">–ë–∞–Ω</button>` : `<button class="admin-button" style="font-size: 11px; padding: 6px 10px;" onclick="unbanUser('${login}')">–†–∞–∑–±–∞–Ω</button>`}
                            </div>
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            document.getElementById('usersAdminTab').innerHTML = html;
        }

        function renderPlayerManagementTab() {
            const html = `
                <div class="admin-section">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–º</h3>
                    <input type="text" class="admin-input" id="targetPlayer" placeholder="–õ–æ–≥–∏–Ω –∏–≥—Ä–æ–∫–∞">
                    <button class="admin-button" onclick="loadPlayerData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <div id="playerDataEditor" class="hidden" style="margin-top: 20px;">
                        <h4 style="color: #e2e8f0; margin-bottom: 15px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                        
                        <div class="admin-row">
                            <div>
                                <label style="color: #94a3b8; display: block; margin-bottom: 5px;">–ë–∞–ª–∞–Ω—Å</label>
                                <input type="number" class="admin-input" id="editCheese">
                            </div>
                            <div>
                                <label style="color: #94a3b8; display: block; margin-bottom: 5px;">–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                <input type="number" class="admin-input" id="editRebirths">
                            </div>
                        </div>

                        <div class="admin-row">
                            <div>
                                <label style="color: #94a3b8; display: block; margin-bottom: 5px;">MMR</label>
                                <input type="number" class="admin-input" id="editMMR">
                            </div>
                            <div>
                                <label style="color: #94a3b8; display: block; margin-bottom: 5px;">CPS</label>
                                <input type="number" class="admin-input" id="editCPS">
                            </div>
                        </div>

                        <button class="admin-button" onclick="savePlayerData()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
                        <button class="admin-button warning" onclick="maxOutPlayer()">‚ö° –ú–ê–ö–° –ü–†–û–ö–ê–ß–ö–ê</button>
                        <button class="admin-button danger" onclick="resetPlayer()">üîÑ –°–ë–†–û–°</button>
                    </div>
                </div>
            `;
            document.getElementById('playerAdminTab').innerHTML = html;
        }

        function renderBroadcastTab() {
            const html = `
                <div class="admin-section">
                    <h3>–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3>
                    <textarea id="broadcastMessage" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö"></textarea>
                    <button class="admin-button" onclick="sendBroadcast()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            `;
            document.getElementById('broadcastAdminTab').innerHTML = html;
        }

        function renderEventsTab() {
            let html = `
                <div class="admin-section">
                    <h3>–ó–∞–ø—É—Å–∫ –µ–≤–µ–Ω—Ç–æ–≤</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #94a3b8; display: block; margin-bottom: 5px;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                        <input type="number" class="admin-input" id="eventDuration" value="10" min="1" max="1440">
                    </div>
                    <div class="event-list">
            `;

            eventsList.forEach(event => {
                html += `
                    <div class="event-card" onclick="startEvent('${event.id}')">
                        <div class="icon">${event.icon}</div>
                        <div class="name">${event.name}</div>
                        <div class="mult">x${event.multiplier}</div>
                    </div>
                `;
            });

            html += `</div></div>`;
            document.getElementById('eventsAdminTab').innerHTML = html;
        }

        window.viewUserLogs = async function(login) {
            const snapshot = await get(ref(database, 'users/' + login));
            
            if (snapshot.exists()) {
                const user = snapshot.val();
                const data = user.gameData || {};
                
                alert(`–õ–æ–≥–∏ ${login}:\n\n` +
                    `–ë–∞–ª–∞–Ω—Å: ${Math.floor(data.cheese || 0).toLocaleString()} üßÄ\n` +
                    `–í—Å–µ–≥–æ: ${Math.floor(data.allTimeCheese || 0).toLocaleString()} üßÄ\n` +
                    `–£—Ä–æ–≤–µ–Ω—å: ${data.level || 1}\n` +
                    `–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è: ${data.rebirths || 0}\n` +
                    `MMR: ${data.pvpMMR || 1000}\n` +
                    `PVP W/L: ${data.pvpWins || 0}/${data.pvpLosses || 0}\n` +
                    `–°–æ–∑–¥–∞–Ω: ${new Date(user.createdAt).toLocaleString()}`
                );
            }
        };

        window.toggleAdmin = async function(login, makeAdmin) {
            await update(ref(database, `users/${login}/gameData`), { isAdmin: makeAdmin });
            showNotification(`–ê–¥–º–∏–Ω–∫–∞ ${makeAdmin ? '–≤—ã–¥–∞–Ω–∞' : '–∑–∞–±—Ä–∞–Ω–∞'}`, 'success');
            loadUsersAdmin();
        };

        window.banUser = async function(login) {
            if (!confirm(`–ó–∞–±–∞–Ω–∏—Ç—å ${login}?`)) return;
            await update(ref(database, `users/${login}/gameData`), { isBanned: true });
            showNotification('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
            loadUsersAdmin();
        };

        window.unbanUser = async function(login) {
            await update(ref(database, `users/${login}/gameData`), { isBanned: false });
            showNotification('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
            loadUsersAdmin();
        };

        window.loadPlayerData = async function() {
            const playerLogin = document.getElementById('targetPlayer').value.trim();
            if (!playerLogin) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω', 'error');
                return;
            }

            const snapshot = await get(ref(database, 'users/' + playerLogin));
            if (!snapshot.exists()) {
                showNotification('–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            const userData = snapshot.val().gameData || {};
            
            document.getElementById('playerDataEditor').classList.remove('hidden');
            document.getElementById('editCheese').value = Math.floor(userData.cheese || 0);
            document.getElementById('editRebirths').value = userData.rebirths || 0;
            document.getElementById('editMMR').value = userData.pvpMMR || 1000;
            document.getElementById('editCPS').value = userData.cheesePerSecond || 0;

            showNotification('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
        };

        window.savePlayerData = async function() {
            const playerLogin = document.getElementById('targetPlayer').value.trim();
            if (!playerLogin) return;

            const cheese = parseInt(document.getElementById('editCheese').value) || 0;
            const rebirths = parseInt(document.getElementById('editRebirths').value) || 0;
            const pvpMMR = parseInt(document.getElementById('editMMR').value) || 1000;
            const cheesePerSecond = parseInt(document.getElementById('editCPS').value) || 0;

            await update(ref(database, `users/${playerLogin}/gameData`), {
                cheese: cheese,
                totalCheese: cheese,
                allTimeCheese: cheese,
                rebirths: rebirths,
                pvpMMR: pvpMMR,
                cheesePerSecond: cheesePerSecond
            });

            showNotification('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            loadUsersAdmin();
            
            if (playerLogin === currentUser) {
                setTimeout(() => location.reload(), 1000);
            }
        };

        window.maxOutPlayer = async function() {
            const playerLogin = document.getElementById('targetPlayer').value.trim();
            if (!playerLogin || !confirm('–í—ã–¥–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∫–∞—á–∫—É?')) return;

            const upgrades = {};
            upgradesList.forEach(u => {
                upgrades[u.id] = 999;
            });

            await update(ref(database, `users/${playerLogin}/gameData`), {
                cheese: 999999999999,
                totalCheese: 999999999999,
                allTimeCheese: 999999999999,
                clickPower: 999999999,
                cheesePerSecond: 999999999,
                upgrades: upgrades,
                intercoms: intercomsList.map(i => i.id),
                sauces: saucesList.map(s => s.id),
                rebirths: 100,
                pvpMMR: 3000
            });

            showNotification('–ú–∞–∫—Å –ø—Ä–æ–∫–∞—á–∫–∞ –≤—ã–¥–∞–Ω–∞!', 'success');
            loadUsersAdmin();
            
            if (playerLogin === currentUser) {
                setTimeout(() => location.reload(), 1000);
            }
        };

        window.resetPlayer = async function() {
            const playerLogin = document.getElementById('targetPlayer').value.trim();
            if (!playerLogin || !confirm('–°–ë–†–û–°–ò–¢–¨ –í–°–ï?')) return;

            const resetData = {
                cheese: 0,
                totalCheese: 0,
                allTimeCheese: 0,
                level: 1,
                rebirths: 0,
                clickPower: 1,
                cheesePerSecond: 0,
                upgrades: {},
                intercoms: ['cyfral'],
                currentIntercom: 'cyfral',
                sauces: ['basic'],
                currentSauce: 'basic',
                intercomBonus: 1,
                sauceBonus: 0,
                pvpMMR: 1000,
                pvpWins: 0,
                pvpLosses: 0,
                currentLocation: 'entrance',
                locationMultiplier: 1
            };

            upgradesList.forEach(u => {
                resetData.upgrades[u.id] = 0;
            });

            await update(ref(database, `users/${playerLogin}/gameData`), resetData);

            showNotification('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω!', 'success');
            loadUsersAdmin();
            
            if (playerLogin === currentUser) {
                setTimeout(() => location.reload(), 1000);
            }
        };

        window.sendBroadcast = async function() {
            const message = document.getElementById('broadcastMessage').value.trim();
            if (!message) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
                return;
            }

            await set(ref(database, 'globalMessage'), {
                author: currentUser,
                message: message,
                timestamp: Date.now()
            });

            showNotification('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
            document.getElementById('broadcastMessage').value = '';
        };

        window.startEvent = async function(eventId) {
            const duration = parseInt(document.getElementById('eventDuration').value) || 10;
            const event = eventsList.find(e => e.id === eventId);
            
            if (!event) return;

            const eventData = {
                ...event,
                starter: currentUser,
                startTime: Date.now(),
                endTime: Date.now() + (duration * 60 * 1000),
                duration: duration
            };

            await set(ref(database, 'activeEvent'), eventData);
            
            await set(ref(database, 'globalMessage'), {
                author: currentUser,
                message: `–ó–∞–ø—É—Å—Ç–∏–ª –µ–≤–µ–Ω—Ç "${event.name}" ${event.icon} (x${event.multiplier}) –Ω–∞ ${duration} –º–∏–Ω!`,
                timestamp: Date.now()
            });

            showNotification('–ï–≤–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω!', 'success');
        };

        function activateEvent(eventData) {
            currentEventData = eventData;
            currentEventMultiplier = eventData.multiplier;

            if (!document.getElementById('eventBanner')) {
                const banner = document.createElement('div');
                banner.id = 'eventBanner';
                banner.className = 'event-banner';
                banner.style.borderColor = eventData.color;
                banner.innerHTML = `
                    <div class="event-icon">${eventData.icon}</div>
                    <div class="event-title" style="color: ${eventData.color}">${eventData.name}</div>
                    <div style="font-size: 1.2em; color: #94a3b8; margin-bottom: 20px;">–ó–∞–ø—É—Å—Ç–∏–ª: ${eventData.starter}</div>
                    <div class="event-multiplier">x${eventData.multiplier}</div>
                    <div style="font-size: 1.5em; color: #e2e8f0;" id="eventTimerBanner">...</div>
                `;
                document.body.appendChild(banner);
                setTimeout(() => banner.remove(), 8000);
            }

            if (!document.getElementById('eventIndicator')) {
                const indicator = document.createElement('div');
                indicator.id = 'eventIndicator';
                indicator.className = 'event-indicator';
                indicator.style.borderColor = eventData.color;
                indicator.innerHTML = `
                    <div style="font-size: 2em;">${eventData.icon}</div>
                    <div>
                        <div style="font-weight: 700; font-size: 1.1em; color: ${eventData.color}">${eventData.name} x${eventData.multiplier}</div>
                        <div style="color: #94a3b8; font-size: 0.9em;" id="eventTimerIndicator">...</div>
                    </div>
                `;
                document.body.appendChild(indicator);
            }

            createEventEffects(eventData.effect);
            updateEventTimer();
        }

        function deactivateEvent() {
            currentEventMultiplier = 1;
            currentEventData = null;

            const banner = document.getElementById('eventBanner');
            if (banner) banner.remove();

            const indicator = document.getElementById('eventIndicator');
            if (indicator) indicator.remove();

            const effects = document.getElementById('eventEffects');
            if (effects) effects.remove();
        }

        function updateEventTimer() {
            if (!currentEventData) return;

            const remaining = currentEventData.endTime - Date.now();
            if (remaining <= 0) {
                deactivateEvent();
                return;
            }

            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            const bannerTimer = document.getElementById('eventTimerBanner');
            if (bannerTimer) bannerTimer.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${timeStr}`;

            const indicatorTimer = document.getElementById('eventTimerIndicator');
            if (indicatorTimer) indicatorTimer.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${timeStr}`;

            setTimeout(updateEventTimer, 1000);
        }

        function createEventEffects(effectType) {
            let existingEffects = document.getElementById('eventEffects');
            if (existingEffects) existingEffects.remove();

            const container = document.createElement('div');
            container.id = 'eventEffects';
            container.className = 'event-effect';

            if (effectType === 'stars') {
                for (let i = 0; i < 50; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 2 + 's';
                    container.appendChild(star);
                }
            } else if (effectType === 'cosmic') {
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'orbit-particle';
                    particle.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
                    particle.style.left = '50%';
                    particle.style.top = '50%';
                    particle.style.animationDuration = (5 + Math.random() * 10) + 's';
                    particle.style.animationDelay = Math.random() * 5 + 's';
                    container.appendChild(particle);
                }
                for (let i = 0; i < 100; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 2 + 's';
                    container.appendChild(star);
                }
            } else if (effectType === 'rainbow') {
                const rainbow = document.createElement('div');
                rainbow.className = 'rainbow-effect';
                container.appendChild(rainbow);
            } else if (effectType === 'snow') {
                for (let i = 0; i < 50; i++) {
                    const snow = document.createElement('div');
                    snow.className = 'snow-particle';
                    snow.style.width = (2 + Math.random() * 6) + 'px';
                    snow.style.height = snow.style.width;
                    snow.style.left = Math.random() * 100 + '%';
                    snow.style.animationDuration = (5 + Math.random() * 10) + 's';
                    snow.style.animationDelay = Math.random() * 5 + 's';
                    container.appendChild(snow);
                }
            }

            document.body.appendChild(container);
        }

        async function saveGame() {
            if (!currentUser) return;
            
            try {
                await update(ref(database, 'users/' + currentUser + '/gameData'), gameData);
                await set(ref(database, 'leaderboard/' + currentUser), {
                    login: currentUser,
                    cheese: gameData.cheese,
                    allTimeCheese: gameData.allTimeCheese,
                    rebirths: gameData.rebirths,
                    level: gameData.level,
                    pvpMMR: gameData.pvpMMR,
                    pvpWins: gameData.pvpWins,
                    pvpLosses: gameData.pvpLosses
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        }

        function renderShop() {
            // Upgrades tab
            let upgradesHTML = '';
            upgradesList.forEach(upgrade => {
                const level = gameData.upgrades[upgrade.id] || 0;
                const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scale, level) * Math.pow(1.2, gameData.rebirths));
                
                upgradesHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">${upgrade.name}</div>
                            <div class="shop-item-level">–£—Ä. ${level}</div>
                        </div>
                        <div class="shop-item-desc">${upgrade.desc}</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${cost.toLocaleString()} üßÄ</div>
                            <button class="buy-btn" data-upgrade="${upgrade.id}">–ö—É–ø–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('upgradesTab').innerHTML = upgradesHTML;

            // Intercoms tab
            let intercomsHTML = '';
            intercomsList.forEach(intercom => {
                const owned = gameData.intercoms.includes(intercom.id);
                const active = gameData.currentIntercom === intercom.id;
                
                let buttonHTML = '';
                if (intercom.id === 'cyfral') {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-intercom="${intercom.id}">–í—ã–±—Ä–∞–Ω</button>`;
                } else if (owned) {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-intercom="${intercom.id}">${active ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å'}</button>`;
                } else {
                    buttonHTML = `<button class="buy-btn" data-buy-intercom="${intercom.id}" data-cost="${intercom.cost}">–ö—É–ø–∏—Ç—å</button>`;
                }
                
                intercomsHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">üö™ ${intercom.name}</div>
                        </div>
                        <div class="shop-item-desc">x${intercom.bonus} –º–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${intercom.cost === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : intercom.cost.toLocaleString() + ' üßÄ'}</div>
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            });
            document.getElementById('intercomsTab').innerHTML = intercomsHTML;

            // Sauces tab
            let saucesHTML = '';
            saucesList.forEach(sauce => {
                const owned = gameData.sauces.includes(sauce.id);
                const active = gameData.currentSauce === sauce.id;
                
                let buttonHTML = '';
                if (sauce.id === 'basic') {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-sauce="${sauce.id}">–í—ã–±—Ä–∞–Ω</button>`;
                } else if (owned) {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-sauce="${sauce.id}">${active ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å'}</button>`;
                } else {
                    buttonHTML = `<button class="buy-btn" data-buy-sauce="${sauce.id}" data-cost="${sauce.cost}">–ö—É–ø–∏—Ç—å</button>`;
                }
                
                saucesHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">${sauce.icon} ${sauce.name}</div>
                        </div>
                        <div class="shop-item-desc">+${sauce.bonus} —Å—ã—Ä–∞ –∑–∞ –∫–ª–∏–∫</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${sauce.cost === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : sauce.cost.toLocaleString() + ' üßÄ'}</div>
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            });
            document.getElementById('sauceTab').innerHTML = saucesHTML;

            // Locations tab
            let locationsHTML = '';
            locationsList.forEach(location => {
                const active = gameData.currentLocation === location.id;
                const canUnlock = gameData.rebirths >= location.requiredRebirths;
                
                let buttonHTML = '';
                if (location.id === 'entrance') {
                    buttonHTML = `<button class="select-btn ${active ? 'active' : ''}" data-select-location="${location.id}">–í—ã–±—Ä–∞–Ω–∞</button>`;
                } else if (active) {
                    buttonHTML = `<button class="select-btn active" data-select-location="${location.id}">–í—ã–±—Ä–∞–Ω–∞</button>`;
                } else if (!canUnlock) {
                    buttonHTML = `<button class="buy-btn" disabled>–ù—É–∂–Ω–æ ${location.requiredRebirths} ‚≠ê</button>`;
                } else {
                    buttonHTML = `<button class="select-btn" data-select-location="${location.id}">–í—ã–±—Ä–∞—Ç—å</button>`;
                }
                
                locationsHTML += `
                    <div class="shop-item">
                        <div class="shop-item-header">
                            <div class="shop-item-name">${location.icon} ${location.name}</div>
                        </div>
                        <div class="shop-item-desc">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${location.multiplier} | –ù—É–∂–Ω–æ ${location.requiredRebirths} ‚≠ê</div>
                        <div class="shop-item-footer">
                            <div class="shop-item-cost">${location.cost === 0 ? '–°–¢–ê–†–¢–û–í–ê–Ø' : location.cost.toLocaleString() + ' üßÄ'}</div>
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            });
            document.getElementById('locationsTab').innerHTML = locationsHTML;
        }

        document.getElementById('intercom').addEventListener('click', function(event) {
            const clickPower = (gameData.clickPower + gameData.sauceBonus) * currentEventMultiplier * gameData.locationMultiplier;
            const bonusMultiplier = 1 + gameData.rebirths * 0.1;
            const totalGain = Math.floor(clickPower * bonusMultiplier);
            
            gameData.cheese += totalGain;
            gameData.totalCheese += totalGain;
            gameData.allTimeCheese += totalGain;

            const splash = document.createElement('div');
            splash.className = 'cheese-splash';
            splash.textContent = `+${totalGain.toLocaleString()} üßÄ`;
            splash.style.left = event.clientX + 'px';
            splash.style.top = event.clientY + 'px';
            splash.style.color = '#fbbf24';
            document.body.appendChild(splash);
            setTimeout(() => splash.remove(), 1500);

            updateUI();
            checkLevelUp();
        });

        function setupEventListeners() {
            document.addEventListener('click', function(e) {
                if (e.target.dataset.upgrade) {
                    const upgrade = upgradesList.find(u => u.id === e.target.dataset.upgrade);
                    if (!upgrade) return;

                    const level = gameData.upgrades[upgrade.id] || 0;
                    const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scale, level) * Math.pow(1.2, gameData.rebirths));

                    if (gameData.cheese >= cost) {
                        gameData.cheese -= cost;
                        gameData.upgrades[upgrade.id]++;

                        if (upgrade.type === 'click') {
                            gameData.clickPower += upgrade.power;
                        } else if (upgrade.type === 'auto') {
                            gameData.cheesePerSecond += upgrade.power;
                        }

                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.buyIntercom) {
                    const cost = parseInt(e.target.dataset.cost);
                    const type = e.target.dataset.buyIntercom;
                    
                    if (gameData.cheese >= cost && !gameData.intercoms.includes(type)) {
                        gameData.cheese -= cost;
                        gameData.intercoms.push(type);
                        
                        const intercom = intercomsList.find(i => i.id === type);
                        if (intercom) {
                            gameData.currentIntercom = type;
                            gameData.intercomBonus = intercom.bonus;
                            updateIntercomVisual(type);
                        }
                        
                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.selectIntercom) {
                    const type = e.target.dataset.selectIntercom;
                    gameData.currentIntercom = type;
                    const intercom = intercomsList.find(i => i.id === type);
                    if (intercom) {
                        gameData.intercomBonus = intercom.bonus;
                        updateIntercomVisual(type);
                    }
                    renderShop();
                    updateUI();
                    saveGame();
                } else if (e.target.dataset.buySauce) {
                    const cost = parseInt(e.target.dataset.cost);
                    const type = e.target.dataset.buySauce;
                    
                    if (gameData.cheese >= cost && !gameData.sauces.includes(type)) {
                        gameData.cheese -= cost;
                        gameData.sauces.push(type);
                        
                        const sauce = saucesList.find(s => s.id === type);
                        if (sauce) {
                            gameData.currentSauce = type;
                            gameData.sauceBonus = sauce.bonus;
                            updateSauceDisplay();
                        }
                        
                        renderShop();
                        updateUI();
                        saveGame();
                    }
                } else if (e.target.dataset.selectSauce) {
                    const type = e.target.dataset.selectSauce;
                    gameData.currentSauce = type;
                    const sauce = saucesList.find(s => s.id === type);
                    if (sauce) {
                        gameData.sauceBonus = sauce.bonus;
                        updateSauceDisplay();
                    }
                    renderShop();
                    updateUI();
                    saveGame();
                } else if (e.target.dataset.selectLocation) {
                    const type = e.target.dataset.selectLocation;
                    const location = locationsList.find(l => l.id === type);
                    
                    if (location && gameData.rebirths >= location.requiredRebirths) {
                        gameData.currentLocation = type;
                        gameData.locationMultiplier = location.multiplier;
                        updateLocationDisplay();
                        renderShop();
                        updateUI();
                        saveGame();
                    }
                }
            });

            document.querySelectorAll('.shop-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    document.getElementById('upgradesTab').classList.add('hidden');
                    document.getElementById('intercomsTab').classList.add('hidden');
                    document.getElementById('sauceTab').classList.add('hidden');
                    document.getElementById('locationsTab').classList.add('hidden');

                    if (this.dataset.tab === 'upgrades') {
                        document.getElementById('upgradesTab').classList.remove('hidden');
                    } else if (this.dataset.tab === 'intercoms') {
                        document.getElementById('intercomsTab').classList.remove('hidden');
                    } else if (this.dataset.tab === 'sauce') {
                        document.getElementById('sauceTab').classList.remove('hidden');
                    } else if (this.dataset.tab === 'locations') {
                        document.getElementById('locationsTab').classList.remove('hidden');
                    }
                });
            });

            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    document.getElementById('usersAdminTab').classList.add('hidden');
                    document.getElementById('playerAdminTab').classList.add('hidden');
                    document.getElementById('broadcastAdminTab').classList.add('hidden');
                    document.getElementById('eventsAdminTab').classList.add('hidden');

                    if (this.dataset.adminTab === 'users') {
                        document.getElementById('usersAdminTab').classList.remove('hidden');
                        loadUsersAdmin();
                    } else if (this.dataset.adminTab === 'player') {
                        document.getElementById('playerAdminTab').classList.remove('hidden');
                    } else if (this.dataset.adminTab === 'broadcast') {
                        document.getElementById('broadcastAdminTab').classList.remove('hidden');
                    } else if (this.dataset.adminTab === 'events') {
                        document.getElementById('eventsAdminTab').classList.remove('hidden');
                    }
                });
            });

            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentLeaderboardTab = this.dataset.lbTab;
                    loadLeaderboard();
                });
            });

            document.getElementById('rebirthBtn').addEventListener('click', doRebirth);
        }

        function updateSauceDisplay() {
            const sauce = saucesList.find(s => s.id === gameData.currentSauce);
            if (sauce) {
                document.getElementById('currentSauce').textContent = `${sauce.icon} ${sauce.name}`;
            }
        }

        function getRebirthCost() {
            return Math.floor(1000000 * Math.pow(5, gameData.rebirths));
        }

        function doRebirth() {
            const rebirthCost = getRebirthCost();
            if (gameData.cheese >= rebirthCost) {
                if (confirm(`–ü–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è? –í—Å–µ —Å–±—Ä–æ—Å–∏—Ç—Å—è.\n\n–ë–æ–Ω—É—Å: +10%\n–ù–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è?\n–°–ª–µ–¥—É—é—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${(rebirthCost * 5).toLocaleString()} üßÄ`)) {
                    gameData.rebirths++;
                    gameData.cheese = 0;
                    gameData.totalCheese = 0;
                    gameData.level = 1;
                    gameData.clickPower = 1;
                    gameData.cheesePerSecond = 0;
                    
                    upgradesList.forEach(u => {
                        gameData.upgrades[u.id] = 0;
                    });
                    
                    gameData.intercoms = ['cyfral'];
                    gameData.currentIntercom = 'cyfral';
                    gameData.sauces = ['basic'];
                    gameData.currentSauce = 'basic';
                    gameData.intercomBonus = 1;
                    gameData.sauceBonus = 0;
                    
                    updateIntercomVisual('cyfral');
                    updateSauceDisplay();
                    renderShop();
                    updateUI();
                    saveGame();
                }
            }
        }

        function checkLevelUp() {
            const nextLevel = gameData.level * 5000;
            if (gameData.totalCheese >= nextLevel) {
                gameData.level++;
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('cheeseCount').textContent = Math.floor(gameData.cheese).toLocaleString();
            document.getElementById('totalCheese').textContent = Math.floor(gameData.allTimeCheese).toLocaleString();
            document.getElementById('levelDisplay').textContent = gameData.level;
            document.getElementById('rebirthCount').textContent = gameData.rebirths;
            document.getElementById('rebirthBonus').textContent = (1 + gameData.rebirths * 0.1).toFixed(1);
            document.getElementById('clickPower').textContent = Math.floor((gameData.clickPower + gameData.sauceBonus) * currentEventMultiplier * gameData.locationMultiplier).toLocaleString();
            
            const cps = Math.floor(gameData.cheesePerSecond * gameData.intercomBonus * (1 + gameData.rebirths * 0.1) * currentEventMultiplier * gameData.locationMultiplier);
            document.getElementById('cheesePerSec').textContent = cps.toLocaleString();

            document.getElementById('pvpWins').textContent = gameData.pvpWins;
            document.getElementById('pvpLosses').textContent = gameData.pvpLosses;

            const rebirthCost = getRebirthCost();
            document.getElementById('rebirthCost').textContent = rebirthCost.toLocaleString();
            
            document.getElementById('rebirthBtn').disabled = gameData.cheese < rebirthCost;
        }

        let currentLeaderboardTab = 'balance';

        async function loadLeaderboard() {
            const snapshot = await get(ref(database, 'leaderboard'));
            if (!snapshot.exists()) {
                document.getElementById('leaderboardList').innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
                return;
            }

            let leaders = Object.values(snapshot.val());

            if (currentLeaderboardTab === 'balance') {
                leaders.sort((a, b) => b.cheese - a.cheese);
            } else if (currentLeaderboardTab === 'pvp') {
                leaders.sort((a, b) => (b.pvpMMR || 1000) - (a.pvpMMR || 1000));
            } else if (currentLeaderboardTab === 'rebirths') {
                leaders.sort((a, b) => b.rebirths - a.rebirths);
            }

            leaders = leaders.slice(0, 10);
            
            const leaderboardHTML = leaders.map((leader, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                
                let scoreText = '';
                if (currentLeaderboardTab === 'balance') {
                    scoreText = `${Math.floor(leader.cheese || 0).toLocaleString()} üßÄ`;
                } else if (currentLeaderboardTab === 'pvp') {
                    const mmr = leader.pvpMMR || 1000;
                    const rank = getRankFromMMR(mmr);
                    scoreText = `${mmr} MMR (${rank.name})`;
                } else {
                    scoreText = `‚≠ê ${leader.rebirths || 0}`;
                }
                
                return `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                        <div class="leaderboard-player">${leader.login}</div>
                        <div class="leaderboard-score">${scoreText}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('leaderboardList').innerHTML = leaderboardHTML;
        }

        function startGameLoop() {
            setInterval(() => {
                const cps = gameData.cheesePerSecond * gameData.intercomBonus * (1 + gameData.rebirths * 0.1) * currentEventMultiplier * gameData.locationMultiplier;
                gameData.cheese += cps / 10;
                gameData.totalCheese += cps / 10;
                gameData.allTimeCheese += cps / 10;
                updateUI();
                checkLevelUp();
            }, 100);

            setInterval(() => {
                saveGame();
            }, 10000);
        }
    </script>
</body>
</html>
